# Python í…ŒìŠ¤íŠ¸ í™˜ê²½ ì„¤ì • ê°€ì´ë“œ
# YouthSchool MVP - Backend Testing

## ğŸ“‹ ëª©ì°¨
1. [í…ŒìŠ¤íŠ¸ í™˜ê²½ ì„¤ì¹˜](#1-í…ŒìŠ¤íŠ¸-í™˜ê²½-ì„¤ì¹˜)
2. [Unit Test (pytest)](#2-unit-test-pytest)
3. [Integration Test](#3-integration-test)
4. [E2E Test (Playwright)](#4-e2e-test-playwright)
5. [í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€](#5-í…ŒìŠ¤íŠ¸-ì»¤ë²„ë¦¬ì§€)
6. [CI/CD í†µí•©](#6-cicd-í†µí•©)

---

## 1. í…ŒìŠ¤íŠ¸ í™˜ê²½ ì„¤ì¹˜

### 1.1 ì˜ì¡´ì„± ì„¤ì¹˜

```bash
# í…ŒìŠ¤íŠ¸ í™˜ê²½ ì„¤ì¹˜
pip install -r requirements-test.txt

# Playwright ë¸Œë¼ìš°ì € ì„¤ì¹˜
playwright install
playwright install-deps
```

### 1.2 í”„ë¡œì íŠ¸ êµ¬ì¡°

```
backend/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ main.py
â”‚   â”œâ”€â”€ routers/
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ hwp_service.py
â”‚   â”‚   â”œâ”€â”€ claude_service.py
â”‚   â”‚   â””â”€â”€ template_service.py
â”‚   â””â”€â”€ models/
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ conftest.py              # pytest fixtures
â”‚   â”œâ”€â”€ unit/                    # ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
â”‚   â”‚   â”œâ”€â”€ test_hwp_service.py
â”‚   â”‚   â”œâ”€â”€ test_claude_service.py
â”‚   â”‚   â””â”€â”€ test_template_service.py
â”‚   â”œâ”€â”€ integration/             # í†µí•© í…ŒìŠ¤íŠ¸
â”‚   â”‚   â”œâ”€â”€ test_api_endpoints.py
â”‚   â”‚   â”œâ”€â”€ test_database.py
â”‚   â”‚   â””â”€â”€ test_document_generation.py
â”‚   â””â”€â”€ e2e/                     # E2E í…ŒìŠ¤íŠ¸
â”‚       â”œâ”€â”€ test_user_flow.py
â”‚       â””â”€â”€ test_document_creation_flow.py
â”œâ”€â”€ pytest.ini
â””â”€â”€ requirements-test.txt
```

---

## 2. Unit Test (pytest)

### 2.1 conftest.py (ê³µí†µ fixtures)

```python
# tests/conftest.py
import pytest
from fastapi.testclient import TestClient
from sqlalchemy import create_engine
from sqlalchemy.orm import sessionmaker
from sqlalchemy.pool import StaticPool

from app.main import app
from app.database import Base, get_db
from app.config import Settings

# í…ŒìŠ¤íŠ¸ìš© ì¸ë©”ëª¨ë¦¬ DB
SQLALCHEMY_DATABASE_URL = "sqlite:///:memory:"

engine = create_engine(
    SQLALCHEMY_DATABASE_URL,
    connect_args={"check_same_thread": False},
    poolclass=StaticPool,
)
TestingSessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)


@pytest.fixture(scope="function")
def db_session():
    """í…ŒìŠ¤íŠ¸ìš© DB ì„¸ì…˜"""
    Base.metadata.create_all(bind=engine)
    session = TestingSessionLocal()
    try:
        yield session
    finally:
        session.close()
        Base.metadata.drop_all(bind=engine)


@pytest.fixture(scope="function")
def client(db_session):
    """í…ŒìŠ¤íŠ¸ìš© FastAPI í´ë¼ì´ì–¸íŠ¸"""
    def override_get_db():
        try:
            yield db_session
        finally:
            db_session.close()
    
    app.dependency_overrides[get_db] = override_get_db
    
    with TestClient(app) as test_client:
        yield test_client
    
    app.dependency_overrides.clear()


@pytest.fixture
def mock_hwp_file(tmp_path):
    """í…ŒìŠ¤íŠ¸ìš© ê°€ì§œ HWP íŒŒì¼"""
    hwp_file = tmp_path / "test.hwp"
    hwp_file.write_bytes(b"Mock HWP content")
    return str(hwp_file)


@pytest.fixture
def mock_claude_response():
    """Mock Claude API ì‘ë‹µ"""
    return {
        "content": [
            {
                "type": "text",
                "text": "í•™ë¶€ëª¨ë‹˜ê»˜,\n\nì•ˆë…•í•˜ì„¸ìš”. ê²¨ìš¸ë°©í•™ ì•ˆì „ ìƒí™œì— ëŒ€í•´ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤..."
            }
        ],
        "model": "claude-sonnet-4-20250514",
        "usage": {
            "input_tokens": 100,
            "output_tokens": 500
        }
    }


@pytest.fixture
def sample_template_input():
    """ìƒ˜í”Œ í…œí”Œë¦¿ ì…ë ¥ ë°ì´í„°"""
    return {
        "template_id": "template_001",
        "document_type": "ê°€ì •í†µì‹ ë¬¸",
        "inputs": {
            "title": "ê²¨ìš¸ë°©í•™ ì•ˆì „ ìƒí™œ ì•ˆë‚´",
            "greeting": "í•™ë¶€ëª¨ë‹˜ ì•ˆë…•í•˜ì„¸ìš”",
            "content": "ê²¨ìš¸ë°©í•™ ë™ì•ˆ ì•ˆì „í•˜ê²Œ ìƒí™œí•˜ë„ë¡ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤."
        }
    }
```

### 2.2 Unit Test ì˜ˆì‹œ - HWP Service

```python
# tests/unit/test_hwp_service.py
import pytest
from unittest.mock import Mock, patch, MagicMock
from app.services.hwp_service import HWPService, HWPParsingError


class TestHWPService:
    """HWP ì„œë¹„ìŠ¤ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸"""
    
    @pytest.fixture
    def hwp_service(self):
        return HWPService()
    
    @pytest.mark.unit
    def test_parse_hwp_file_success(self, hwp_service, mock_hwp_file):
        """HWP íŒŒì¼ íŒŒì‹± ì„±ê³µ"""
        # Given
        with patch('win32com.client.Dispatch') as mock_dispatch:
            mock_hwp = MagicMock()
            mock_dispatch.return_value = mock_hwp
            mock_hwp.Open.return_value = True
            
            # When
            result = hwp_service.parse(mock_hwp_file)
            
            # Then
            assert result is not None
            assert hasattr(result, 'fields')
            mock_hwp.Open.assert_called_once()
    
    @pytest.mark.unit
    def test_parse_invalid_file(self, hwp_service):
        """ì˜ëª»ëœ íŒŒì¼ íŒŒì‹± ì‹œ ì—ëŸ¬"""
        # Given
        invalid_file = "nonexistent.hwp"
        
        # When & Then
        with pytest.raises(HWPParsingError):
            hwp_service.parse(invalid_file)
    
    @pytest.mark.unit
    def test_extract_fields(self, hwp_service, mock_hwp_file):
        """HWP í•„ë“œ ì¶”ì¶œ í…ŒìŠ¤íŠ¸"""
        # Given
        with patch('win32com.client.Dispatch') as mock_dispatch:
            mock_hwp = MagicMock()
            mock_dispatch.return_value = mock_hwp
            
            # Mock í•„ë“œ ë°ì´í„°
            mock_hwp.GetFieldText.side_effect = [
                "ì œëª© í•„ë“œ",
                "ë‚´ìš© í•„ë“œ"
            ]
            
            # When
            result = hwp_service.extract_fields(mock_hwp_file)
            
            # Then
            assert "title" in result
            assert "content" in result
            assert result["title"] == "ì œëª© í•„ë“œ"
    
    @pytest.mark.hwp
    @pytest.mark.skipif(
        "sys.platform != 'win32'",
        reason="HWPëŠ” Windowsì—ì„œë§Œ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥"
    )
    def test_real_hwp_file(self, hwp_service):
        """ì‹¤ì œ HWP íŒŒì¼ í…ŒìŠ¤íŠ¸ (Windows ì „ìš©)"""
        # ì‹¤ì œ í•œê¸€ í”„ë¡œê·¸ë¨ì´ ì„¤ì¹˜ëœ í™˜ê²½ì—ì„œë§Œ ì‹¤í–‰
        real_hwp_path = "tests/fixtures/sample.hwp"
        
        result = hwp_service.parse(real_hwp_path)
        
        assert result is not None
```

### 2.3 Unit Test ì˜ˆì‹œ - Claude Service

```python
# tests/unit/test_claude_service.py
import pytest
from unittest.mock import Mock, patch
from app.services.claude_service import ClaudeService


class TestClaudeService:
    """Claude AI ì„œë¹„ìŠ¤ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸"""
    
    @pytest.fixture
    def claude_service(self):
        return ClaudeService(api_key="test-key")
    
    @pytest.mark.unit
    @pytest.mark.ai
    def test_generate_document_success(
        self, 
        claude_service, 
        mock_claude_response,
        sample_template_input
    ):
        """ë¬¸ì„œ ìƒì„± ì„±ê³µ í…ŒìŠ¤íŠ¸"""
        # Given
        with patch.object(claude_service.client.messages, 'create') as mock_create:
            mock_create.return_value = Mock(**mock_claude_response)
            
            # When
            result = claude_service.generate_document(
                prompt="ê°€ì •í†µì‹ ë¬¸ì„ ì‘ì„±í•´ì£¼ì„¸ìš”",
                context=sample_template_input
            )
            
            # Then
            assert result is not None
            assert "í•™ë¶€ëª¨ë‹˜ê»˜" in result
            mock_create.assert_called_once()
    
    @pytest.mark.unit
    def test_generate_with_invalid_api_key(self):
        """ì˜ëª»ëœ API í‚¤ë¡œ ìƒì„± ì‹œë„"""
        # Given
        service = ClaudeService(api_key="invalid-key")
        
        # When & Then
        with pytest.raises(Exception):
            service.generate_document("í…ŒìŠ¤íŠ¸", {})
    
    @pytest.mark.unit
    def test_token_counting(self, claude_service, mock_claude_response):
        """í† í° ì‚¬ìš©ëŸ‰ ê³„ì‚° í…ŒìŠ¤íŠ¸"""
        # Given
        with patch.object(claude_service.client.messages, 'create') as mock_create:
            mock_create.return_value = Mock(**mock_claude_response)
            
            # When
            result = claude_service.generate_document("í…ŒìŠ¤íŠ¸", {})
            tokens = claude_service.get_last_token_usage()
            
            # Then
            assert tokens['input_tokens'] == 100
            assert tokens['output_tokens'] == 500
```

---

## 3. Integration Test

### 3.1 API ì—”ë“œí¬ì¸íŠ¸ í†µí•© í…ŒìŠ¤íŠ¸

```python
# tests/integration/test_api_endpoints.py
import pytest
from fastapi import status


class TestTemplateEndpoints:
    """í…œí”Œë¦¿ API í†µí•© í…ŒìŠ¤íŠ¸"""
    
    @pytest.mark.integration
    def test_get_templates(self, client):
        """í…œí”Œë¦¿ ëª©ë¡ ì¡°íšŒ"""
        # When
        response = client.get("/api/v1/templates")
        
        # Then
        assert response.status_code == status.HTTP_200_OK
        data = response.json()
        assert "data" in data
        assert len(data["data"]) >= 2  # ê¸°ë³¸ í…œí”Œë¦¿ 2ê°œ
    
    @pytest.mark.integration
    def test_upload_template(self, client, mock_hwp_file):
        """í…œí”Œë¦¿ ì—…ë¡œë“œ"""
        # Given
        with open(mock_hwp_file, 'rb') as f:
            files = {'file': ('test.hwp', f, 'application/x-hwp')}
            data = {'name': 'í…ŒìŠ¤íŠ¸ í…œí”Œë¦¿'}
            
            # When
            response = client.post(
                "/api/v1/templates/upload",
                files=files,
                data=data
            )
        
        # Then
        assert response.status_code == status.HTTP_201_CREATED
        result = response.json()
        assert result["success"] is True
        assert "id" in result["data"]


class TestDocumentGeneration:
    """ë¬¸ì„œ ìƒì„± API í†µí•© í…ŒìŠ¤íŠ¸"""
    
    @pytest.mark.integration
    @pytest.mark.slow
    def test_generate_document_full_flow(self, client, sample_template_input):
        """ì „ì²´ ë¬¸ì„œ ìƒì„± í”Œë¡œìš°"""
        # Given
        with patch('app.services.claude_service.ClaudeService.generate_document') as mock_gen:
            mock_gen.return_value = "ìƒì„±ëœ ë¬¸ì„œ ë‚´ìš©"
            
            # When
            response = client.post(
                "/api/v1/documents/generate",
                json=sample_template_input
            )
            
            # Then
            assert response.status_code == status.HTTP_200_OK
            data = response.json()
            assert data["success"] is True
            assert "document_id" in data["data"]
            assert "download_url" in data["data"]
    
    @pytest.mark.integration
    def test_download_generated_document(self, client, db_session):
        """ìƒì„±ëœ ë¬¸ì„œ ë‹¤ìš´ë¡œë“œ"""
        # Given
        document_id = "doc_20250115_001"
        
        # When
        response = client.get(f"/api/v1/documents/{document_id}/download")
        
        # Then
        assert response.status_code == status.HTTP_200_OK
        assert response.headers["content-type"] == "application/octet-stream"
```

### 3.2 Database í†µí•© í…ŒìŠ¤íŠ¸

```python
# tests/integration/test_database.py
import pytest
from app.models.template import Template
from app.models.document import GeneratedDocument
from app.models.user import User


class TestDatabaseOperations:
    """ë°ì´í„°ë² ì´ìŠ¤ CRUD í…ŒìŠ¤íŠ¸"""
    
    @pytest.mark.integration
    @pytest.mark.db
    def test_create_template(self, db_session):
        """í…œí”Œë¦¿ ìƒì„±"""
        # Given
        template = Template(
            name="í…ŒìŠ¤íŠ¸ í…œí”Œë¦¿",
            category="communication",
            file_path="/templates/test.hwp"
        )
        
        # When
        db_session.add(template)
        db_session.commit()
        
        # Then
        saved = db_session.query(Template).filter_by(name="í…ŒìŠ¤íŠ¸ í…œí”Œë¦¿").first()
        assert saved is not None
        assert saved.category == "communication"
    
    @pytest.mark.integration
    @pytest.mark.db
    def test_template_relationships(self, db_session):
        """í…œí”Œë¦¿-ë¬¸ì„œ ê´€ê³„ í…ŒìŠ¤íŠ¸"""
        # Given
        template = Template(name="í…œí”Œë¦¿", category="test", file_path="/test.hwp")
        db_session.add(template)
        db_session.commit()
        
        document = GeneratedDocument(
            template_id=template.id,
            document_type="test",
            file_path="/output/test.hwp"
        )
        db_session.add(document)
        db_session.commit()
        
        # When
        saved_template = db_session.query(Template).filter_by(name="í…œí”Œë¦¿").first()
        
        # Then
        assert len(saved_template.documents) == 1
        assert saved_template.documents[0].document_type == "test"
```

---

## 4. E2E Test (Playwright)

### 4.1 Playwright ì„¤ì •

```python
# tests/conftest.py (ì¶”ê°€)
import pytest
from playwright.sync_api import sync_playwright


@pytest.fixture(scope="session")
def browser():
    """Playwright ë¸Œë¼ìš°ì € ì¸ìŠ¤í„´ìŠ¤"""
    with sync_playwright() as p:
        browser = p.chromium.launch(headless=True)
        yield browser
        browser.close()


@pytest.fixture(scope="function")
def page(browser):
    """ìƒˆ í˜ì´ì§€ (ê° í…ŒìŠ¤íŠ¸ë§ˆë‹¤)"""
    context = browser.new_context()
    page = context.new_page()
    yield page
    context.close()
```

### 4.2 E2E Test ì˜ˆì‹œ

```python
# tests/e2e/test_document_creation_flow.py
import pytest
from playwright.sync_api import expect


class TestDocumentCreationFlow:
    """ë¬¸ì„œ ìƒì„± ì „ì²´ í”Œë¡œìš° E2E í…ŒìŠ¤íŠ¸"""
    
    @pytest.mark.e2e
    def test_create_newsletter_full_flow(self, page):
        """ê°€ì •í†µì‹ ë¬¸ ìƒì„± ì „ì²´ í”Œë¡œìš°"""
        # Given - ë©”ì¸ í˜ì´ì§€ ì ‘ì†
        page.goto("http://localhost:8000")
        
        # When - ë¬¸ì„œ ìœ í˜• ì„ íƒ
        page.click("text=ê°€ì •í†µì‹ ë¬¸")
        
        # Then - ì…ë ¥ í¼ í˜ì´ì§€ë¡œ ì´ë™
        expect(page).to_have_url("http://localhost:8000/form")
        
        # When - ì •ë³´ ì…ë ¥
        page.fill('input[name="title"]', "ê²¨ìš¸ë°©í•™ ì•ˆì „ ì•ˆë‚´")
        page.fill('textarea[name="content"]', "ì•ˆì „í•˜ê²Œ ê²¨ìš¸ë°©í•™ì„ ë³´ë‚´ì„¸ìš”")
        
        # ìƒì„± ë²„íŠ¼ í´ë¦­
        page.click('button:has-text("ë¬¸ì„œ ìƒì„±")')
        
        # Then - ìƒì„± ì™„ë£Œ í™•ì¸
        expect(page.locator(".success-message")).to_be_visible()
        expect(page.locator('a:has-text("ë‹¤ìš´ë¡œë“œ")')).to_be_visible()
    
    @pytest.mark.e2e
    def test_template_upload_flow(self, page):
        """í…œí”Œë¦¿ ì—…ë¡œë“œ í”Œë¡œìš°"""
        # Given
        page.goto("http://localhost:8000")
        page.click("text=ë‚´ í…œí”Œë¦¿ ì—…ë¡œë“œ")
        
        # When - íŒŒì¼ ì—…ë¡œë“œ
        page.set_input_files(
            'input[type="file"]',
            'tests/fixtures/sample.hwp'
        )
        page.fill('input[name="name"]', "ë‚´ ì»¤ìŠ¤í…€ í…œí”Œë¦¿")
        page.click('button:has-text("ì—…ë¡œë“œ")')
        
        # Then
        expect(page.locator(".upload-success")).to_be_visible()
    
    @pytest.mark.e2e
    @pytest.mark.slow
    def test_ai_generation_with_preview(self, page):
        """AI ìƒì„± + ë¯¸ë¦¬ë³´ê¸° í”Œë¡œìš°"""
        # Given
        page.goto("http://localhost:8000/form")
        page.fill('input[name="title"]', "í…ŒìŠ¤íŠ¸ ì œëª©")
        
        # When - AI ìƒì„± ë²„íŠ¼
        page.click('button:has-text("AI ìƒì„±")')
        
        # ë¡œë”© í‘œì‹œ í™•ì¸
        expect(page.locator(".loading-spinner")).to_be_visible()
        
        # AI ìƒì„± ì™„ë£Œ ëŒ€ê¸° (ìµœëŒ€ 30ì´ˆ)
        page.wait_for_selector(".preview-content", timeout=30000)
        
        # Then - ë¯¸ë¦¬ë³´ê¸° ë‚´ìš© í™•ì¸
        preview = page.locator(".preview-content").inner_text()
        assert len(preview) > 100  # ìµœì†Œ 100ì ì´ìƒ
        assert "í•™ë¶€ëª¨ë‹˜" in preview or "ì•ˆë…•í•˜ì„¸ìš”" in preview
```

### 4.3 ìŠ¤í¬ë¦°ìƒ· í…ŒìŠ¤íŠ¸

```python
# tests/e2e/test_visual_regression.py
import pytest


class TestVisualRegression:
    """UI ì‹œê°ì  íšŒê·€ í…ŒìŠ¤íŠ¸"""
    
    @pytest.mark.e2e
    def test_homepage_screenshot(self, page):
        """ë©”ì¸ í˜ì´ì§€ ìŠ¤í¬ë¦°ìƒ·"""
        page.goto("http://localhost:8000")
        page.screenshot(path="tests/screenshots/homepage.png")
        
        # ì‹œê°ì  ë¹„êµ (ì„ íƒ)
        # assert page.screenshot() == baseline_screenshot
    
    @pytest.mark.e2e
    def test_form_page_screenshot(self, page):
        """ì…ë ¥ í¼ í˜ì´ì§€ ìŠ¤í¬ë¦°ìƒ·"""
        page.goto("http://localhost:8000/form")
        page.screenshot(path="tests/screenshots/form-page.png")
```

---

## 5. í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€

### 5.1 ì»¤ë²„ë¦¬ì§€ ì‹¤í–‰

```bash
# í…ŒìŠ¤íŠ¸ + ì»¤ë²„ë¦¬ì§€ ë¦¬í¬íŠ¸
pytest --cov=app --cov-report=html

# HTML ë¦¬í¬íŠ¸ í™•ì¸
open htmlcov/index.html  # Mac
start htmlcov/index.html  # Windows

# í„°ë¯¸ë„ì—ì„œ ë°”ë¡œ í™•ì¸
pytest --cov=app --cov-report=term-missing

# íŠ¹ì • íŒŒì¼ë§Œ ì»¤ë²„ë¦¬ì§€
pytest --cov=app.services --cov-report=term
```

### 5.2 ì»¤ë²„ë¦¬ì§€ ëª©í‘œ

```python
# pytest.iniì—ì„œ ì„¤ì •
[tool:pytest]
addopts = --cov-fail-under=80

# ëª©í‘œ:
# - Unit Test: 90% ì´ìƒ
# - Integration Test: 80% ì´ìƒ
# - ì „ì²´: 80% ì´ìƒ
```

### 5.3 ì»¤ë²„ë¦¬ì§€ ì œì™¸

```ini
# pytest.ini
[coverage:run]
omit =
    */tests/*
    */migrations/*
    */scripts/*
    */__pycache__/*

[coverage:report]
exclude_lines =
    pragma: no cover
    def __repr__
    raise NotImplementedError
    if __name__ == .__main__.:
    if TYPE_CHECKING:
```

---

## 6. CI/CD í†µí•©

### 6.1 GitHub Actions ì›Œí¬í”Œë¡œìš°

```yaml
# .github/workflows/test.yml
name: Tests

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]

jobs:
  test:
    runs-on: ubuntu-latest
    
    services:
      postgres:
        image: postgres:16-alpine
        env:
          POSTGRES_PASSWORD: postgres
          POSTGRES_DB: youthschool_test
        options: >-
          --health-cmd pg_isready
          --health-interval 10s
          --health-timeout 5s
          --health-retries 5
        ports:
          - 5432:5432
    
    steps:
      - uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: Cache dependencies
        uses: actions/cache@v3
        with:
          path: ~/.cache/pip
          key: ${{ runner.os }}-pip-${{ hashFiles('**/requirements*.txt') }}
      
      - name: Install dependencies
        run: |
          pip install -r requirements-test.txt
      
      - name: Run Unit Tests
        run: |
          pytest tests/unit -v --cov=app --cov-report=xml
      
      - name: Run Integration Tests
        env:
          DATABASE_URL: postgresql://postgres:postgres@localhost:5432/youthschool_test
        run: |
          pytest tests/integration -v
      
      - name: Install Playwright
        run: |
          playwright install --with-deps chromium
      
      - name: Run E2E Tests
        run: |
          pytest tests/e2e -v
      
      - name: Upload Coverage
        uses: codecov/codecov-action@v3
        with:
          file: ./coverage.xml
          fail_ci_if_error: true
      
      - name: Upload Test Results
        if: always()
        uses: actions/upload-artifact@v3
        with:
          name: test-results
          path: htmlcov/
```

---

## 7. í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ê°€ì´ë“œ

### 7.1 ê¸°ë³¸ ì‹¤í–‰

```bash
# ëª¨ë“  í…ŒìŠ¤íŠ¸ ì‹¤í–‰
pytest

# íŠ¹ì • ë””ë ‰í† ë¦¬
pytest tests/unit
pytest tests/integration
pytest tests/e2e

# íŠ¹ì • íŒŒì¼
pytest tests/unit/test_hwp_service.py

# íŠ¹ì • í…ŒìŠ¤íŠ¸ í•¨ìˆ˜
pytest tests/unit/test_hwp_service.py::test_parse_hwp_file_success
```

### 7.2 ë§ˆì»¤ í™œìš©

```bash
# Unit í…ŒìŠ¤íŠ¸ë§Œ (ë¹ ë¦„)
pytest -m unit

# Integration í…ŒìŠ¤íŠ¸ë§Œ
pytest -m integration

# E2E í…ŒìŠ¤íŠ¸ë§Œ
pytest -m e2e

# HWP í…ŒìŠ¤íŠ¸ ì œì™¸ (Linux/Mac)
pytest -m "not hwp"

# AI í…ŒìŠ¤íŠ¸ ì œì™¸ (API í‚¤ ì—†ì„ ë•Œ)
pytest -m "not ai"

# Slow í…ŒìŠ¤íŠ¸ ì œì™¸
pytest -m "not slow"

# ì¡°í•©
pytest -m "unit and not hwp"
```

### 7.3 ë³‘ë ¬ ì‹¤í–‰

```bash
# CPU ì½”ì–´ ìˆ˜ë§Œí¼ ë³‘ë ¬ ì‹¤í–‰
pytest -n auto

# 4ê°œ í”„ë¡œì„¸ìŠ¤ë¡œ ë³‘ë ¬
pytest -n 4

# Unit í…ŒìŠ¤íŠ¸ë§Œ ë³‘ë ¬
pytest tests/unit -n auto
```

### 7.4 ë””ë²„ê¹…

```bash
# ì‹¤íŒ¨ ì‹œ ì¦‰ì‹œ ì¤‘ë‹¨
pytest -x

# ë§ˆì§€ë§‰ ì‹¤íŒ¨ í…ŒìŠ¤íŠ¸ë§Œ ì¬ì‹¤í–‰
pytest --lf

# ì‹¤íŒ¨í•œ í…ŒìŠ¤íŠ¸ ë¨¼ì € ì‹¤í–‰
pytest --ff

# PDB ë””ë²„ê±° ì‹¤í–‰
pytest --pdb

# ìƒì„¸ ë¡œê·¸
pytest -vv -s
```

---

## 8. ëª¨ë²” ì‚¬ë¡€

### 8.1 í…ŒìŠ¤íŠ¸ ì‘ì„± ì›ì¹™

#### AAA íŒ¨í„´
```python
def test_example():
    # Arrange (ì¤€ë¹„)
    service = MyService()
    data = {"key": "value"}
    
    # Act (ì‹¤í–‰)
    result = service.process(data)
    
    # Assert (ê²€ì¦)
    assert result == expected_value
```

#### í…ŒìŠ¤íŠ¸ ëª…ëª… ê·œì¹™
```python
# âœ… ì¢‹ì€ ì˜ˆ
def test_parse_hwp_file_success():
    """HWP íŒŒì¼ íŒŒì‹± ì„±ê³µ ì¼€ì´ìŠ¤"""
    
def test_generate_document_with_invalid_template():
    """ì˜ëª»ëœ í…œí”Œë¦¿ìœ¼ë¡œ ë¬¸ì„œ ìƒì„± ì‹œë„"""

# âŒ ë‚˜ìœ ì˜ˆ
def test1():
def test_function():
```

### 8.2 Mock ì‚¬ìš©

```python
# ì™¸ë¶€ ì˜ì¡´ì„± Mock
@patch('app.services.claude_service.Anthropic')
def test_with_mock(mock_anthropic):
    mock_client = Mock()
    mock_anthropic.return_value = mock_client
    # í…ŒìŠ¤íŠ¸ ë¡œì§
```

### 8.3 Fixture ì¬ì‚¬ìš©

```python
# conftest.pyì— ê³µí†µ fixture ì •ì˜
@pytest.fixture
def common_data():
    return {"key": "value"}

# ì—¬ëŸ¬ í…ŒìŠ¤íŠ¸ì—ì„œ ì¬ì‚¬ìš©
def test_a(common_data):
    assert common_data["key"] == "value"

def test_b(common_data):
    assert "key" in common_data
```

---

## 9. ë¬¸ì œ í•´ê²°

### 9.1 ì¼ë°˜ì ì¸ ë¬¸ì œ

```bash
# ì—ëŸ¬: ModuleNotFoundError
# í•´ê²°: PYTHONPATH ì„¤ì •
export PYTHONPATH="${PYTHONPATH}:$(pwd)"
pytest

# ì—ëŸ¬: Database connection failed
# í•´ê²°: Docker PostgreSQL ì‹œì‘
docker-compose up -d postgres

# ì—ëŸ¬: Playwright browser not found
# í•´ê²°: ë¸Œë¼ìš°ì € ì¬ì„¤ì¹˜
playwright install
```

---

## ğŸ“Š ìš”ì•½

| í…ŒìŠ¤íŠ¸ ìœ í˜• | ë„êµ¬ | ì‹¤í–‰ ëª…ë ¹ | ëª©í‘œ ì»¤ë²„ë¦¬ì§€ |
|------------|------|----------|--------------|
| **Unit** | pytest | `pytest -m unit` | 90%+ |
| **Integration** | pytest + TestClient | `pytest -m integration` | 80%+ |
| **E2E** | Playwright | `pytest -m e2e` | ì£¼ìš” í”Œë¡œìš° |
| **ì „ì²´** | pytest | `pytest` | 80%+ |

**ë‹¤ìŒ ë‹¨ê³„**: ì‹¤ì œ í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„± ì‹œì‘! ğŸš€
