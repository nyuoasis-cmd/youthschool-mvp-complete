# Docker ê°œë°œ í™˜ê²½ ê°€ì´ë“œ
# YouthSchool MVP + RAG í™•ì¥

## ğŸ“‹ ëª©ì°¨
1. [Docker í™˜ê²½ êµ¬ì„±](#1-docker-í™˜ê²½-êµ¬ì„±)
2. [ì„œë¹„ìŠ¤ ì‹œì‘ ë° ì¤‘ì§€](#2-ì„œë¹„ìŠ¤-ì‹œì‘-ë°-ì¤‘ì§€)
3. [Hot Reload ì„¤ì •](#3-hot-reload-ì„¤ì •)
4. [ë°ì´í„°ë² ì´ìŠ¤ ì—°ë™](#4-ë°ì´í„°ë² ì´ìŠ¤-ì—°ë™)
5. [ë³¼ë¥¨ ë§ˆìš´íŠ¸ ì„¤ì •](#5-ë³¼ë¥¨-ë§ˆìš´íŠ¸-ì„¤ì •)
6. [ë„¤íŠ¸ì›Œí¬ ì„¤ì •](#6-ë„¤íŠ¸ì›Œí¬-ì„¤ì •)
7. [RAG ì‹œìŠ¤í…œ êµ¬ì„±](#7-rag-ì‹œìŠ¤í…œ-êµ¬ì„±)
8. [ë¬¸ì œ í•´ê²°](#8-ë¬¸ì œ-í•´ê²°)

---

## 1. Docker í™˜ê²½ êµ¬ì„±

### 1.1 ì‹œìŠ¤í…œ ìš”êµ¬ì‚¬í•­

| í•­ëª© | ìµœì†Œ | ê¶Œì¥ |
|------|------|------|
| Docker | 20.10+ | 24.0+ |
| Docker Compose | 2.0+ | 2.20+ |
| RAM | 4GB | 8GB+ |
| ë””ìŠ¤í¬ | 10GB | 20GB+ |

### 1.2 Docker ì„¤ì¹˜

#### Windows
```powershell
# Docker Desktop ì„¤ì¹˜
# https://www.docker.com/products/docker-desktop/

# ì„¤ì¹˜ í™•ì¸
docker --version
docker-compose --version
```

#### Mac
```bash
# Homebrewë¡œ ì„¤ì¹˜
brew install --cask docker

# ë˜ëŠ” Docker Desktop ë‹¤ìš´ë¡œë“œ
# https://www.docker.com/products/docker-desktop/
```

#### Linux
```bash
# Ubuntu/Debian
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh

# Docker Compose ì„¤ì¹˜
sudo curl -L "https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose
```

---

## 2. ì„œë¹„ìŠ¤ ì‹œì‘ ë° ì¤‘ì§€

### 2.1 ì´ˆê¸° ì„¤ì •

```bash
# 1. í”„ë¡œì íŠ¸ ë””ë ‰í† ë¦¬ë¡œ ì´ë™
cd youthschool-mvp

# 2. í™˜ê²½ ë³€ìˆ˜ íŒŒì¼ ìƒì„±
cp .env.example .env

# 3. .env íŒŒì¼ í¸ì§‘ (ANTHROPIC_API_KEY ë“±)
nano .env
```

### 2.2 ê°œë°œ í™˜ê²½ ì‹œì‘

```bash
# ê¸°ë³¸ ì„œë¹„ìŠ¤ ì‹œì‘ (backend + postgres + redis + qdrant)
docker-compose up -d

# ë¡œê·¸ í™•ì¸
docker-compose logs -f

# íŠ¹ì • ì„œë¹„ìŠ¤ ë¡œê·¸ë§Œ ë³´ê¸°
docker-compose logs -f backend

# ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸
docker-compose ps
```

### 2.3 ì„œë¹„ìŠ¤ ì¤‘ì§€

```bash
# ì„œë¹„ìŠ¤ ì¤‘ì§€ (ì»¨í…Œì´ë„ˆ ìœ ì§€)
docker-compose stop

# ì„œë¹„ìŠ¤ ì¤‘ì§€ ë° ì œê±°
docker-compose down

# ë³¼ë¥¨ê¹Œì§€ ëª¨ë‘ ì œê±° (ë°ì´í„° ì‚­ì œ!)
docker-compose down -v
```

### 2.4 í”„ë¡œíŒŒì¼ë³„ ì‹¤í–‰

```bash
# ê¸°ë³¸ ê°œë°œ í™˜ê²½
docker-compose up -d

# ê´€ë¦¬ ë„êµ¬ í¬í•¨ (pgAdmin ë“±)
docker-compose --profile tools up -d

# RAG ê¸°ëŠ¥ í¬í•¨
docker-compose --profile rag up -d

# ëª¨ë“  ì„œë¹„ìŠ¤ ì‹¤í–‰
docker-compose --profile tools --profile rag up -d
```

---

## 3. Hot Reload ì„¤ì •

### 3.1 ì‘ë™ ì›ë¦¬

```yaml
# docker-compose.ymlì˜ ë³¼ë¥¨ ë§ˆìš´íŠ¸
volumes:
  - ./backend:/app  # ë¡œì»¬ ì½”ë“œë¥¼ ì»¨í…Œì´ë„ˆì— ë§ˆìš´íŠ¸
  - /app/__pycache__  # ìºì‹œ ë””ë ‰í† ë¦¬ëŠ” ì œì™¸

# uvicorn --reload ì˜µì…˜ìœ¼ë¡œ ìë™ ì¬ì‹œì‘
command: uvicorn app.main:app --reload
```

### 3.2 ì½”ë“œ ë³€ê²½ ì‹œ ë™ì‘

```bash
# 1. ë¡œì»¬ì—ì„œ ì½”ë“œ ìˆ˜ì •
# backend/app/main.py í¸ì§‘

# 2. ì €ì¥ ì¦‰ì‹œ uvicornì´ ê°ì§€í•˜ê³  ìë™ ì¬ì‹œì‘
# ë¡œê·¸ì—ì„œ í™•ì¸:
# INFO:     Shutting down
# INFO:     Waiting for application shutdown.
# INFO:     Application startup complete.

# 3. API ì¦‰ì‹œ ë°˜ì˜ë¨
curl http://localhost:8000/docs
```

### 3.3 Hot Reload ë¹„í™œì„±í™” (í”„ë¡œë•ì…˜)

```yaml
# docker-compose.prod.yml
services:
  backend:
    command: uvicorn app.main:app --host 0.0.0.0 --workers 4
    # --reload ì˜µì…˜ ì œê±°
```

---

## 4. ë°ì´í„°ë² ì´ìŠ¤ ì—°ë™

### 4.1 PostgreSQL ì ‘ì†

#### 4.1.1 Docker ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì—ì„œ
```bash
# PostgreSQL ì»¨í…Œì´ë„ˆ ì ‘ì†
docker exec -it youthschool-postgres psql -U postgres -d youthschool

# SQL ì‹¤í–‰
youthschool=# \dt  -- í…Œì´ë¸” ëª©ë¡
youthschool=# SELECT * FROM users;
youthschool=# \q  -- ì¢…ë£Œ
```

#### 4.1.2 ë¡œì»¬ì—ì„œ ì ‘ì†
```bash
# psql í´ë¼ì´ì–¸íŠ¸ ì„¤ì¹˜ í•„ìš”
psql -h localhost -p 5432 -U postgres -d youthschool

# ë˜ëŠ” DBeaver, DataGrip ë“± GUI ë„êµ¬ ì‚¬ìš©
# Host: localhost
# Port: 5432
# Database: youthschool
# User: postgres
# Password: postgres
```

#### 4.1.3 pgAdmin ì‚¬ìš© (ì›¹ UI)
```bash
# pgAdmin ì„œë¹„ìŠ¤ ì‹œì‘
docker-compose --profile tools up -d pgadmin

# ë¸Œë¼ìš°ì €ì—ì„œ ì ‘ì†
http://localhost:5050

# ë¡œê·¸ì¸ ì •ë³´
# Email: admin@youthschool.com
# Password: admin

# ì„œë²„ ë“±ë¡
# Host: postgres (ì»¨í…Œì´ë„ˆ ì´ë¦„)
# Port: 5432
# Username: postgres
# Password: postgres
```

### 4.2 ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜

```bash
# Alembic ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰
docker-compose exec backend alembic upgrade head

# ìƒˆ ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„±
docker-compose exec backend alembic revision --autogenerate -m "Add users table"

# ë§ˆì´ê·¸ë ˆì´ì…˜ íˆìŠ¤í† ë¦¬ í™•ì¸
docker-compose exec backend alembic history

# ë¡¤ë°±
docker-compose exec backend alembic downgrade -1
```

### 4.3 ì´ˆê¸° ë°ì´í„° ì‚½ì…

```bash
# ì´ˆê¸° ë°ì´í„° ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
docker-compose exec backend python scripts/seed_data.py

# SQL íŒŒì¼ë¡œ ì‚½ì…
docker exec -i youthschool-postgres psql -U postgres -d youthschool < ./scripts/init-data.sql
```

---

## 5. ë³¼ë¥¨ ë§ˆìš´íŠ¸ ì„¤ì •

### 5.1 ë³¼ë¥¨ ì¢…ë¥˜

#### 5.1.1 Named Volume (ì˜êµ¬ ì €ì¥)
```yaml
volumes:
  postgres-data:  # ë°ì´í„°ë² ì´ìŠ¤ ë°ì´í„°
  redis-data:     # Redis ìºì‹œ
  qdrant-data:    # ë²¡í„° DB
```

**íŠ¹ì§•**:
- Dockerê°€ ê´€ë¦¬í•˜ëŠ” ìœ„ì¹˜ì— ì €ì¥
- ì»¨í…Œì´ë„ˆ ì‚­ì œ ì‹œì—ë„ ë°ì´í„° ìœ ì§€
- ë°±ì—…/ë³µì› ìš©ì´

**ìœ„ì¹˜ í™•ì¸**:
```bash
# ë³¼ë¥¨ ëª©ë¡
docker volume ls

# ë³¼ë¥¨ ìƒì„¸ ì •ë³´
docker volume inspect youthschool-mvp_postgres-data

# ì‹¤ì œ ê²½ë¡œ (Linux)
# /var/lib/docker/volumes/youthschool-mvp_postgres-data/_data
```

#### 5.1.2 Bind Mount (ê°œë°œìš©)
```yaml
volumes:
  - ./backend:/app  # ë¡œì»¬ ë””ë ‰í† ë¦¬ë¥¼ ì»¨í…Œì´ë„ˆì— ë§ˆìš´íŠ¸
```

**íŠ¹ì§•**:
- ë¡œì»¬ íŒŒì¼ ì‹œìŠ¤í…œì˜ íŠ¹ì • ê²½ë¡œ ë§ˆìš´íŠ¸
- Hot Reloadì— ì‚¬ìš©
- ì§ì ‘ íŒŒì¼ í¸ì§‘ ê°€ëŠ¥

### 5.2 ë³¼ë¥¨ ê´€ë¦¬

```bash
# ë³¼ë¥¨ ëª©ë¡
docker volume ls

# ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ë³¼ë¥¨ ì œê±°
docker volume prune

# íŠ¹ì • ë³¼ë¥¨ ì œê±°
docker volume rm youthschool-mvp_postgres-data

# ë³¼ë¥¨ ë°±ì—… (ë°ì´í„°ë² ì´ìŠ¤)
docker run --rm \
  -v youthschool-mvp_postgres-data:/data \
  -v $(pwd):/backup \
  alpine tar czf /backup/postgres-backup.tar.gz -C /data .

# ë³¼ë¥¨ ë³µì›
docker run --rm \
  -v youthschool-mvp_postgres-data:/data \
  -v $(pwd):/backup \
  alpine tar xzf /backup/postgres-backup.tar.gz -C /data
```

### 5.3 ë¡œê·¸ ë³¼ë¥¨

```yaml
volumes:
  backend-logs:/app/logs  # ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œê·¸
```

**ë¡œê·¸ í™•ì¸**:
```bash
# ì»¨í…Œì´ë„ˆ ë‚´ë¶€ ë¡œê·¸ ë³´ê¸°
docker-compose exec backend cat /app/logs/app.log

# ì‹¤ì‹œê°„ ë¡œê·¸ tail
docker-compose exec backend tail -f /app/logs/app.log

# ë¡œì»¬ë¡œ ë³µì‚¬
docker cp youthschool-backend:/app/logs/app.log ./local-logs/
```

---

## 6. ë„¤íŠ¸ì›Œí¬ ì„¤ì •

### 6.1 ë„¤íŠ¸ì›Œí¬ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   youthschool-network (172.20.0.0/16)
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ Backend  â”‚  â”‚ Postgres â”‚       â”‚
â”‚  â”‚ :8000    â”‚â”€â”€â”‚ :5432    â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚       â”‚                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚  Redis   â”‚  â”‚  Qdrant  â”‚       â”‚
â”‚  â”‚  :6379   â”‚  â”‚  :6333   â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ Port Mapping
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Host Machine   â”‚
â”‚  localhost:8000 â”‚
â”‚  localhost:5432 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 ì„œë¹„ìŠ¤ ê°„ í†µì‹ 

#### 6.2.1 ì»¨í…Œì´ë„ˆ ì´ë¦„ìœ¼ë¡œ ì ‘ì†
```python
# backendì—ì„œ postgres ì ‘ì†
DATABASE_URL = "postgresql://postgres:postgres@postgres:5432/youthschool"
#                                              ^^^^^^^^
#                                            ì»¨í…Œì´ë„ˆ ì´ë¦„

# backendì—ì„œ redis ì ‘ì†
REDIS_URL = "redis://redis:6379/0"
#                    ^^^^^
#                  ì»¨í…Œì´ë„ˆ ì´ë¦„
```

#### 6.2.2 ë„¤íŠ¸ì›Œí¬ ê²©ë¦¬
```yaml
# ë‹¤ë¥¸ ë„¤íŠ¸ì›Œí¬ë¡œ ë¶„ë¦¬ ê°€ëŠ¥
networks:
  frontend-network:  # í”„ë¡ íŠ¸ì—”ë“œìš©
  backend-network:   # ë°±ì—”ë“œìš©
  db-network:        # DB ì „ìš©
```

### 6.3 í¬íŠ¸ ë§¤í•‘

```yaml
ports:
  - "8000:8000"  # Host:Container
  - "5432:5432"
```

**ì ‘ì† ë°©ë²•**:
```bash
# í˜¸ìŠ¤íŠ¸ì—ì„œ ì ‘ì†
curl http://localhost:8000/docs

# ë‹¤ë¥¸ ì»¨í…Œì´ë„ˆì—ì„œ ì ‘ì†
curl http://backend:8000/docs
```

### 6.4 ë„¤íŠ¸ì›Œí¬ ê´€ë¦¬

```bash
# ë„¤íŠ¸ì›Œí¬ ëª©ë¡
docker network ls

# ë„¤íŠ¸ì›Œí¬ ìƒì„¸ ì •ë³´
docker network inspect youthschool-mvp_youthschool-network

# íŠ¹ì • ì»¨í…Œì´ë„ˆì˜ IP í™•ì¸
docker inspect youthschool-backend | grep IPAddress

# ë„¤íŠ¸ì›Œí¬ ì œê±°
docker network rm youthschool-mvp_youthschool-network
```

---

## 7. RAG ì‹œìŠ¤í…œ êµ¬ì„±

### 7.1 RAG ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   RAG Pipeline                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                â”‚                â”‚
        â–¼                â–¼                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   MinIO      â”‚  â”‚   Qdrant     â”‚  â”‚    Redis     â”‚
â”‚ (ë¬¸ì„œ ì €ì¥)   â”‚  â”‚ (ë²¡í„° ê²€ìƒ‰)   â”‚  â”‚  (ìºì‹±)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                â”‚                â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚   Backend    â”‚
                â”‚   FastAPI    â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚  Claude API  â”‚
                â”‚  (ìƒì„±)      â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 RAG ì„œë¹„ìŠ¤ ì‹œì‘

```bash
# RAG í”„ë¡œíŒŒì¼ë¡œ ì‹œì‘
docker-compose --profile rag up -d

# ì„œë¹„ìŠ¤ í™•ì¸
docker-compose ps

# ë‹¤ìŒ ì„œë¹„ìŠ¤ê°€ ì‹¤í–‰ë¨:
# - backend
# - postgres
# - redis
# - qdrant (ë²¡í„° DB)
# - minio (ë¬¸ì„œ ì €ì¥ì†Œ)
```

### 7.3 Qdrant (ë²¡í„° ë°ì´í„°ë² ì´ìŠ¤)

#### 7.3.1 Qdrant ëŒ€ì‹œë³´ë“œ
```bash
# ë¸Œë¼ìš°ì €ì—ì„œ ì ‘ì†
http://localhost:6333/dashboard

# API ë¬¸ì„œ
http://localhost:6333/docs
```

#### 7.3.2 ì»¬ë ‰ì…˜ ìƒì„±
```python
# backend/app/services/rag_service.py
from qdrant_client import QdrantClient
from qdrant_client.models import Distance, VectorParams

client = QdrantClient(url="http://qdrant:6333")

# ì»¬ë ‰ì…˜ ìƒì„±
client.create_collection(
    collection_name="youthschool_documents",
    vectors_config=VectorParams(
        size=1536,  # text-embedding-3-small ì°¨ì›
        distance=Distance.COSINE
    )
)
```

#### 7.3.3 ë²¡í„° ì‚½ì…
```python
# ë¬¸ì„œ ì„ë² ë”© ìƒì„± ë° ì €ì¥
from anthropic import Anthropic

client_anthropic = Anthropic()

# ì„ë² ë”© ìƒì„± (ClaudeëŠ” í˜„ì¬ ì„ë² ë”© ë¯¸ì§€ì›, OpenAI ì‚¬ìš©)
# ë˜ëŠ” sentence-transformers ì‚¬ìš©
from sentence_transformers import SentenceTransformer

model = SentenceTransformer('all-MiniLM-L6-v2')
embedding = model.encode("ë¬¸ì„œ ë‚´ìš©")

# Qdrantì— ì €ì¥
client.upsert(
    collection_name="youthschool_documents",
    points=[
        {
            "id": 1,
            "vector": embedding.tolist(),
            "payload": {
                "text": "ë¬¸ì„œ ë‚´ìš©",
                "source": "ê°€ì •í†µì‹ ë¬¸.hwp"
            }
        }
    ]
)
```

### 7.4 MinIO (ë¬¸ì„œ ì €ì¥ì†Œ)

#### 7.4.1 MinIO ì½˜ì†”
```bash
# ë¸Œë¼ìš°ì €ì—ì„œ ì ‘ì†
http://localhost:9001

# ë¡œê·¸ì¸ ì •ë³´
# Username: minioadmin
# Password: minioadmin
```

#### 7.4.2 ë²„í‚· ìƒì„±
```bash
# MinIO CLI ì„¤ì¹˜
docker exec -it youthschool-minio mc alias set myminio http://localhost:9000 minioadmin minioadmin

# ë²„í‚· ìƒì„±
docker exec -it youthschool-minio mc mb myminio/youthschool-docs

# íŒŒì¼ ì—…ë¡œë“œ
docker exec -it youthschool-minio mc cp /path/to/file.hwp myminio/youthschool-docs/
```

#### 7.4.3 Python SDK ì‚¬ìš©
```python
# backend/app/services/storage_service.py
from minio import Minio

client = Minio(
    "minio:9000",
    access_key="minioadmin",
    secret_key="minioadmin",
    secure=False
)

# íŒŒì¼ ì—…ë¡œë“œ
client.fput_object(
    "youthschool-docs",
    "ê°€ì •í†µì‹ ë¬¸.hwp",
    "/path/to/file.hwp"
)

# íŒŒì¼ ë‹¤ìš´ë¡œë“œ
client.fget_object(
    "youthschool-docs",
    "ê°€ì •í†µì‹ ë¬¸.hwp",
    "/tmp/downloaded.hwp"
)
```

### 7.5 RAG íŒŒì´í”„ë¼ì¸ êµ¬í˜„

```python
# backend/app/services/rag_pipeline.py

class RAGPipeline:
    def __init__(self):
        self.qdrant = QdrantClient(url="http://qdrant:6333")
        self.minio = Minio("minio:9000", ...)
        self.anthropic = Anthropic()
    
    async def process_document(self, file_path: str):
        """ë¬¸ì„œë¥¼ RAG ì‹œìŠ¤í…œì— ì¶”ê°€"""
        # 1. MinIOì— ì›ë³¸ ì €ì¥
        self.minio.fput_object(...)
        
        # 2. ë¬¸ì„œ íŒŒì‹± (HWP â†’ í…ìŠ¤íŠ¸)
        text = parse_hwp(file_path)
        
        # 3. ì²­í¬ ë¶„í• 
        chunks = split_text(text, chunk_size=500)
        
        # 4. ì„ë² ë”© ìƒì„±
        embeddings = generate_embeddings(chunks)
        
        # 5. Qdrantì— ì €ì¥
        self.qdrant.upsert(
            collection_name="youthschool_documents",
            points=[...]
        )
    
    async def retrieve(self, query: str, top_k: int = 5):
        """ìœ ì‚¬ ë¬¸ì„œ ê²€ìƒ‰"""
        # 1. ì¿¼ë¦¬ ì„ë² ë”©
        query_embedding = generate_embedding(query)
        
        # 2. Qdrant ê²€ìƒ‰
        results = self.qdrant.search(
            collection_name="youthschool_documents",
            query_vector=query_embedding,
            limit=top_k
        )
        
        return results
    
    async def generate_with_context(self, query: str):
        """RAG ê¸°ë°˜ ë¬¸ì„œ ìƒì„±"""
        # 1. ê´€ë ¨ ë¬¸ì„œ ê²€ìƒ‰
        contexts = await self.retrieve(query)
        
        # 2. ì»¨í…ìŠ¤íŠ¸ì™€ í•¨ê»˜ Claude API í˜¸ì¶œ
        prompt = f"""
        ì°¸ê³  ë¬¸ì„œ:
        {contexts}
        
        ì‚¬ìš©ì ìš”ì²­:
        {query}
        
        ìœ„ ì°¸ê³  ë¬¸ì„œë¥¼ ë°”íƒ•ìœ¼ë¡œ ìƒˆë¡œìš´ ë¬¸ì„œë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”.
        """
        
        response = self.anthropic.messages.create(
            model="claude-sonnet-4-20250514",
            messages=[{"role": "user", "content": prompt}]
        )
        
        return response.content[0].text
```

### 7.6 RAG ê¸°ëŠ¥ í™œì„±í™”

```bash
# .env íŒŒì¼ ìˆ˜ì •
RAG_ENABLED=true
ENABLE_RAG=true

# ì„œë¹„ìŠ¤ ì¬ì‹œì‘
docker-compose restart backend
```

---

## 8. ë¬¸ì œ í•´ê²°

### 8.1 ì¼ë°˜ì ì¸ ë¬¸ì œ

#### 8.1.1 í¬íŠ¸ ì¶©ëŒ
```bash
# ì—ëŸ¬: Bind for 0.0.0.0:8000 failed: port is already allocated

# í•´ê²° 1: ì‚¬ìš© ì¤‘ì¸ í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ
# Windows
netstat -ano | findstr :8000
taskkill /PID <PID> /F

# Mac/Linux
lsof -ti:8000 | xargs kill -9

# í•´ê²° 2: docker-compose.yml í¬íŠ¸ ë³€ê²½
ports:
  - "8001:8000"  # í˜¸ìŠ¤íŠ¸ í¬íŠ¸ ë³€ê²½
```

#### 8.1.2 ë³¼ë¥¨ ê¶Œí•œ ì˜¤ë¥˜
```bash
# ì—ëŸ¬: Permission denied

# í•´ê²° (Linux)
sudo chown -R $USER:$USER ./backend
chmod -R 755 ./backend

# í•´ê²° (Docker ë‚´ë¶€)
docker-compose exec backend chown -R root:root /app
```

#### 8.1.3 ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜
```bash
# ì—ëŸ¬: could not connect to postgres

# í•´ê²° 1: ì„œë¹„ìŠ¤ ì‹œì‘ ìˆœì„œ í™•ì¸
docker-compose up -d postgres
docker-compose up -d backend

# í•´ê²° 2: depends_on í™•ì¸
# docker-compose.ymlì—ì„œ depends_on ì„¤ì • í™•ì¸

# í•´ê²° 3: ë„¤íŠ¸ì›Œí¬ ì¬ìƒì„±
docker-compose down
docker network prune
docker-compose up -d
```

### 8.2 ë¡œê·¸ í™•ì¸

```bash
# ì „ì²´ ë¡œê·¸
docker-compose logs

# íŠ¹ì • ì„œë¹„ìŠ¤
docker-compose logs backend

# ì‹¤ì‹œê°„ ë¡œê·¸
docker-compose logs -f backend

# ìµœê·¼ 100ì¤„ë§Œ
docker-compose logs --tail=100 backend
```

### 8.3 ì»¨í…Œì´ë„ˆ ì ‘ì†

```bash
# ë°±ì—”ë“œ ì»¨í…Œì´ë„ˆ ì‰˜ ì ‘ì†
docker-compose exec backend bash

# PostgreSQL ì ‘ì†
docker-compose exec postgres psql -U postgres

# Redis ì ‘ì†
docker-compose exec redis redis-cli
```

### 8.4 ì™„ì „ ì´ˆê¸°í™”

```bash
# ëª¨ë“  ì»¨í…Œì´ë„ˆ, ë³¼ë¥¨, ë„¤íŠ¸ì›Œí¬ ì œê±°
docker-compose down -v
docker system prune -a --volumes

# ì²˜ìŒë¶€í„° ë‹¤ì‹œ ì‹œì‘
docker-compose up -d --build
```

---

## 9. ê°œë°œ ì›Œí¬í”Œë¡œìš°

### 9.1 ì¼ì¼ ê°œë°œ ë£¨í‹´

```bash
# 1. ì„œë¹„ìŠ¤ ì‹œì‘
docker-compose up -d

# 2. ë¡œê·¸ í™•ì¸
docker-compose logs -f backend

# 3. ì½”ë“œ ìˆ˜ì • (ë¡œì»¬ì—ì„œ)
# backend/app/main.py í¸ì§‘
# ì €ì¥ ì‹œ ìë™ ì¬ì‹œì‘

# 4. API í…ŒìŠ¤íŠ¸
curl http://localhost:8000/docs

# 5. ì‘ì—… ì¢…ë£Œ
docker-compose stop
```

### 9.2 ë°ì´í„°ë² ì´ìŠ¤ ì‘ì—…

```bash
# ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„±
docker-compose exec backend alembic revision --autogenerate -m "Add new table"

# ë§ˆì´ê·¸ë ˆì´ì…˜ ì ìš©
docker-compose exec backend alembic upgrade head

# DB ë°±ì—…
docker exec youthschool-postgres pg_dump -U postgres youthschool > backup.sql

# DB ë³µì›
docker exec -i youthschool-postgres psql -U postgres youthschool < backup.sql
```

### 9.3 í…ŒìŠ¤íŠ¸ ì‹¤í–‰

```bash
# ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
docker-compose exec backend pytest

# ì»¤ë²„ë¦¬ì§€ í¬í•¨
docker-compose exec backend pytest --cov=app

# íŠ¹ì • í…ŒìŠ¤íŠ¸ë§Œ
docker-compose exec backend pytest tests/test_hwp_service.py
```

---

## 10. í”„ë¡œë•ì…˜ ë°°í¬

### 10.1 í”„ë¡œë•ì…˜ ì„¤ì •

```bash
# docker-compose.prod.yml ì‚¬ìš©
docker-compose -f docker-compose.prod.yml up -d

# ì£¼ìš” ì°¨ì´ì :
# - --reload ì œê±°
# - workers ì¦ê°€
# - DEBUG=false
# - PostgreSQL ì™¸ë¶€ í˜¸ìŠ¤íŠ¸ ì‚¬ìš©
```

### 10.2 ìŠ¤ì¼€ì¼ë§

```bash
# ë°±ì—”ë“œ ì¸ìŠ¤í„´ìŠ¤ 3ê°œë¡œ ìŠ¤ì¼€ì¼
docker-compose up -d --scale backend=3

# Nginx ë¡œë“œë°¸ëŸ°ì„œ í•„ìš”
```

---

## ğŸ“Š ìš”ì•½

| ê¸°ëŠ¥ | ëª…ë ¹ì–´ | í¬íŠ¸ |
|------|--------|------|
| **Backend API** | `docker-compose up -d` | 8000 |
| **PostgreSQL** | ìë™ ì‹œì‘ | 5432 |
| **Redis** | ìë™ ì‹œì‘ | 6379 |
| **Qdrant** | `--profile rag` | 6333 |
| **MinIO** | `--profile rag` | 9000, 9001 |
| **pgAdmin** | `--profile tools` | 5050 |

**ë‹¤ìŒ ë‹¨ê³„**: ì‹¤ì œ FastAPI ì• í”Œë¦¬ì¼€ì´ì…˜ ì½”ë“œ ì‘ì„± ì‹œì‘! ğŸš€
