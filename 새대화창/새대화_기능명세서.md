# YouthSchool 새 대화 기능 명세서

**문서 버전**: 1.0  
**작성일**: 2025-01-18  
**프로젝트**: YouthSchool AI 문서 자동화 시스템  

---

## 1. 개요

### 1.1 목적
YouthSchool의 핵심 기능인 AI 대화 인터페이스를 정의하여, 교사 및 행정직원이 자연스러운 대화를 통해 학교 행정 문서를 생성하고 업무 관련 질문에 대한 답변을 받을 수 있도록 한다.

### 1.2 적용 범위
- 일반 회원의 AI 대화 기능
- RAG(Retrieval-Augmented Generation) 기반 전문화된 답변
- 대화 이력 저장 및 관리
- 첨부파일 업로드 및 분석

### 1.3 핵심 특징
- **교육 특화**: 크롤링된 교육청/학교 데이터 기반 답변
- **문서 자동화**: 대화를 통한 행정 문서 자동 생성
- **컨텍스트 유지**: 대화 맥락을 이해하는 연속적 대화
- **파일 지원**: HWP, PDF, DOCX 등 교육 문서 형식 지원

---

## 2. 기능 요구사항

### 2.1 기본 대화 기능

#### 2.1.1 대화 시작

**기능 설명**
- 사용자가 '새 대화' 버튼을 클릭하여 AI와의 새로운 대화 세션을 시작
- 각 대화는 독립적인 컨텍스트를 가지며 고유 ID로 관리

**사용자 플로우**
```
[사용자] 로그인 후 메인 화면 진입
    ↓
[사용자] 좌측 메뉴 '새 대화' 클릭 또는 '+' 버튼 클릭
    ↓
[시스템] 새 대화 세션 생성 (chat_id 발급)
    ↓
[시스템] 빈 대화 화면 표시
    ↓
[시스템] 환영 메시지 및 가이드 표시
```

**환영 메시지 예시**
```
김○○ 선생님,

접속시간이 가까워지고 있습니다 👋 
학생들과 함께하는 멋있는 시간이 되길 바랍니다!

무엇을 도와드릴까요?
```

**화면 구성 요소**
- 대화 입력창
- 파일 첨부 버튼
- 음성 입력 버튼 (향후 확장)
- 전송 버튼
- 빠른 시작 가이드 (첫 대화 시)

#### 2.1.2 메시지 입력 및 전송

**입력 방식**
1. **텍스트 입력**
   - 멀티라인 지원 (Shift+Enter로 줄바꿈)
   - 최대 입력 길이: 10,000자
   - 실시간 글자 수 표시 (9,000자 이상 시)

2. **파일 첨부**
   - 드래그 앤 드롭 지원
   - 클릭하여 파일 선택
   - 첨부 후 미리보기 표시

**전송 동작**
```
[사용자] 메시지 입력 완료
    ↓
[사용자] Enter 또는 전송 버튼 클릭
    ↓
[시스템] 입력 내용 검증
    ↓
[시스템] 메시지를 서버로 전송
    ↓
[시스템] 사용자 메시지를 대화창에 표시
    ↓
[시스템] AI 응답 대기 상태 표시 (로딩 애니메이션)
    ↓
[시스템] AI 응답 수신 및 표시 (스트리밍)
```

**입력 제약사항**
- 빈 메시지 전송 불가
- 연속 메시지 전송 제한: 3초 간격
- 과도한 요청 방지: 1분에 최대 20회

#### 2.1.3 메시지 표시

**사용자 메시지**
```
┌────────────────────────────────────────┐
│                          [사용자 이름] │
│                  안녕하세요             │
│                  방과후학교 가정통신문  │
│                  만들어주세요           │
│                                   09:15 │
└────────────────────────────────────────┘
```

**AI 응답 메시지**
```
┌────────────────────────────────────────┐
│ [AI 아이콘]                            │
│ 안녕하세요! 방과후학교 가정통신문을    │
│ 작성해드리겠습니다.                    │
│                                        │
│ 몇 가지 정보가 필요합니다:             │
│ 1. 프로그램 운영 기간                  │
│ 2. 대상 학년                           │
│ 3. 프로그램 종류                       │
│                                        │
│ 위 정보를 알려주시겠어요?              │
│                                   09:15 │
│ [복사] [재생성] [👍] [👎]              │
└────────────────────────────────────────┘
```

**메시지 기능**
- **복사**: 응답 내용을 클립보드에 복사
- **재생성**: 같은 질문으로 다시 답변 요청
- **피드백**: 좋아요/싫어요로 응답 품질 평가
- **타임스탬프**: 메시지 전송 시각 표시

---

### 2.2 RAG 기반 답변

#### 2.2.1 RAG 시스템 구조

**데이터 소스**
```
┌─────────────────────────────────────┐
│ RAG 지식 베이스                      │
├─────────────────────────────────────┤
│ 1. 크롤링 데이터                     │
│    • 교육청 공지사항                 │
│    • 학교 자료실 문서                │
│    • 행정 안내문                     │
│    • 교육 정책 자료                  │
│                                      │
│ 2. 문서 템플릿                       │
│    • 가정통신문 템플릿               │
│    • 공지사항 템플릿                 │
│    • 방과후학교 관련 문서            │
│    • 학사일정 관련 문서              │
│                                      │
│ 3. 교육 법령/지침                    │
│    • 초중등교육법                    │
│    • 학교안전사고 예방 지침          │
│    • 개인정보보호 가이드             │
└─────────────────────────────────────┘
```

**RAG 처리 프로세스**
```
[사용자 질문]
    ↓
[시스템] 질문 임베딩 생성
    ↓
[시스템] 벡터 DB에서 관련 문서 검색
    ↓
[시스템] 상위 K개 문서 추출 (K=5~10)
    ↓
[시스템] 검색된 문서를 컨텍스트로 포함
    ↓
[AI] 컨텍스트 기반 답변 생성
    ↓
[시스템] 출처 정보 포함하여 응답
```

#### 2.2.2 답변 품질 보장

**답변 검증 기준**
1. **정확성**: RAG 데이터에 기반한 사실적 답변
2. **완전성**: 질문에 대한 충분한 정보 제공
3. **명확성**: 교육 현장에서 바로 활용 가능한 구체적 답변
4. **출처 제공**: 참고한 자료의 출처 명시

**답변 형식**
```
[답변 내용]

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📚 참고 자료
• 서울특별시교육청 공지사항 (2024-12-15)
  "2025학년도 방과후학교 운영 계획"
• ○○초등학교 자료실 (2024-11-20)
  "방과후학교 가정통신문 샘플"
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

#### 2.2.3 전문 영역 답변

**지원 카테고리**
1. **방과후학교**
   - 운영 계획서
   - 가정통신문
   - 수강 신청 안내
   - 강사 채용 공고

2. **학사 일정**
   - 연간 학사일정
   - 시험 일정 안내
   - 방학 계획

3. **공지사항**
   - 학부모 공지
   - 교직원 공지
   - 학생 안내

4. **상담 자료**
   - 학부모 상담 기록
   - 상담 계획서
   - 상담 결과 통보

5. **행정 문서**
   - 품의서
   - 결재 문서
   - 보고서

**질문 유형별 답변 예시**

**유형 1: 정보 조회**
```
Q: 2025년 방과후학교 운영 기준이 어떻게 되나요?

A: 2025년 방과후학교 운영 기준은 다음과 같습니다:

1. 운영 시간
   • 정규 수업 이후 또는 방학 중 운영
   • 1일 최대 4시간 이내

2. 수강료
   • 학부모 수익자 부담 원칙
   • 저소득층 학생 지원 가능

3. 강사 자격
   • 관련 분야 전문성 보유자
   • 성범죄 경력 조회 필수

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📚 참고 자료
• 교육부 "2025년 방과후학교 운영 가이드라인"
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

**유형 2: 문서 생성**
```
Q: 겨울방학 방과후학교 가정통신문 만들어주세요

A: 가정통신문 초안을 작성했습니다. 아래 내용을 확인하시고 
수정이 필요한 부분을 말씀해주세요.

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

가 정 통 신 문

학부모님께

안녕하십니까? 
○○초등학교에서 알려드립니다.

2025학년도 겨울방학 방과후학교 프로그램을 다음과 같이 
운영하고자 하오니 많은 관심과 참여 부탁드립니다.

1. 운영 기간: 2025년 1월 15일(수) ~ 2월 14일(금)
2. 운영 시간: 09:00 ~ 12:00
3. 신청 방법: 학교 홈페이지 온라인 신청
4. 신청 기간: 2025년 1월 2일(목) ~ 1월 10일(금)

[프로그램 안내]
...

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

수정이 필요하신가요?
[HWP 다운로드] [계속 수정하기] [새로 작성하기]
```

**유형 3: 절차 안내**
```
Q: 현장체험학습 계획서는 어떻게 작성하나요?

A: 현장체험학습 계획서 작성 절차를 안내드립니다.

1️⃣ 사전 준비 (출발 7일 전)
   • 목적지 및 일정 확정
   • 안전 계획 수립
   • 학부모 동의서 징구

2️⃣ 계획서 작성
   필수 포함 항목:
   • 목적 및 기대효과
   • 일시, 장소, 참가 인원
   • 세부 일정
   • 안전 대책
   • 예산 계획

3️⃣ 결재 진행
   • 담당 → 부장 → 교감 → 교장

4️⃣ 실시 및 사후 처리
   • 결과보고서 작성
   • 정산 처리

계획서 양식을 작성해드릴까요?

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📚 참고 자료
• 교육부 "현장체험학습 운영 매뉴얼" (2024)
• ○○교육청 "체험학습 안전 가이드"
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

#### 2.2.4 답변 불가 상황 처리

**범위 외 질문**
```
Q: 최신 K-POP 노래 추천해주세요

A: 죄송합니다. 저는 학교 행정 업무를 돕는 YouthSchool AI입니다.

다음과 같은 질문에 답변할 수 있습니다:
• 학교 행정 문서 작성
• 교육 정책 및 법령 안내
• 방과후학교, 학사일정 관련 정보
• 공문서 작성 가이드

학교 업무와 관련된 질문이 있으시면 말씀해주세요! 😊
```

**정보 부족**
```
Q: 우리 학교 2025년 예산은 얼마인가요?

A: 죄송합니다. 개별 학교의 예산 정보는 제공되지 않습니다.

대신 다음을 도와드릴 수 있습니다:
• 예산서 작성 양식 제공
• 교육청 예산 편성 기준 안내
• 예산 집행 절차 안내

필요하신 내용을 구체적으로 말씀해주시겠어요?
```

---

### 2.3 대화 이력 저장

#### 2.3.1 자동 저장

**저장 시점**
- 메시지 전송 즉시 자동 저장
- 별도의 저장 버튼 없음
- 실시간 동기화

**저장 데이터**
```json
{
  "chat_id": "chat_20250118_001234",
  "user_id": 1234,
  "created_at": "2025-01-18T09:15:00Z",
  "updated_at": "2025-01-18T09:30:00Z",
  "title": "방과후학교 가정통신문 작성",
  "messages": [
    {
      "message_id": "msg_001",
      "role": "user",
      "content": "방과후학교 가정통신문 만들어주세요",
      "timestamp": "2025-01-18T09:15:00Z",
      "attachments": []
    },
    {
      "message_id": "msg_002",
      "role": "assistant",
      "content": "가정통신문을 작성해드리겠습니다...",
      "timestamp": "2025-01-18T09:15:05Z",
      "sources": [
        {
          "title": "방과후학교 운영 가이드",
          "url": "https://...",
          "date": "2024-12-15"
        }
      ]
    }
  ],
  "metadata": {
    "total_messages": 10,
    "category": "방과후학교",
    "tags": ["가정통신문", "안내문"],
    "is_pinned": false
  }
}
```

#### 2.3.2 대화 목록

**좌측 사이드바 표시**
```
┌─ 새 대화 (+) ───────────────────────┐
│                                      │
│ 🔍 대화 검색                         │
│                                      │
│ ━━━━━ 오늘 ━━━━━                    │
│ 📄 방과후학교 가정통신문             │
│    "방과후학교 가정통신문..."  09:30  │
│                                      │
│ 📊 학사일정 공지사항                 │
│    "1학기 학사일정 공지..."    08:45  │
│                                      │
│ ━━━━━ 어제 ━━━━━                    │
│ 📝 현장체험학습 계획서               │
│    "현장체험학습 계획서 작성..." 15:20│
│                                      │
│ 🎓 학부모 상담 기록                  │
│    "학부모 상담 내용 정리..."   14:30│
│                                      │
│ ━━━━━ 이번 주 ━━━━━                 │
│ ...                                  │
│                                      │
│ ━━━━━ 이번 달 ━━━━━                 │
│ ...                                  │
└──────────────────────────────────────┘
```

**표시 정보**
- 대화 제목 (자동 생성 또는 수동 편집)
- 첫 메시지 미리보기 (30자)
- 마지막 업데이트 시간
- 카테고리 아이콘

**정렬 옵션**
- 최근 순 (기본)
- 오래된 순
- 제목 가나다순

**그룹화**
- 오늘
- 어제
- 이번 주
- 이번 달
- 그 이전

#### 2.3.3 대화 관리

**제목 수정**
```
[대화 제목] 우클릭 또는 롱프레스
    ↓
[메뉴] "제목 변경" 선택
    ↓
[입력창] 새 제목 입력
    ↓
[시스템] 제목 업데이트 및 목록 반영
```

**대화 고정**
```
[대화 항목] 우클릭
    ↓
[메뉴] "상단 고정" 선택
    ↓
[시스템] 대화를 목록 최상단에 고정
    ↓
[표시] 📌 아이콘 표시
```

**대화 삭제**
```
[대화 항목] 우클릭
    ↓
[메뉴] "삭제" 선택
    ↓
[확인 팝업] "이 대화를 삭제하시겠습니까?"
    ↓
[사용자] 확인
    ↓
[시스템] 대화 삭제 (복구 불가 안내)
    ↓
[시스템] 목록에서 제거
```

**대화 검색**
```
┌─ 대화 검색 ─────────────────────────┐
│ 🔍 [검색어 입력]                     │
│                                      │
│ 검색 결과: 3개                       │
│                                      │
│ 📄 방과후학교 가정통신문 (2025-01-18)│
│    "...방과후학교 프로그램..."        │
│                                      │
│ 📊 방과후 프로그램 안내 (2025-01-15) │
│    "...방과후 운영 계획..."           │
│                                      │
│ 🎓 방과후 수강신청 (2025-01-10)      │
│    "...수강 신청 방법..."             │
└──────────────────────────────────────┘
```

**검색 범위**
- 대화 제목
- 메시지 내용
- 첨부파일 이름

#### 2.3.4 대화 내보내기

**내보내기 형식**
1. **PDF**
   - 전체 대화 내역
   - 타임스탬프 포함
   - 첨부파일 링크 포함

2. **텍스트**
   - 순수 텍스트 형식
   - 편집 가능

3. **JSON**
   - 전체 데이터 구조
   - 백업 및 이전 용도

**내보내기 프로세스**
```
[대화 화면] 우측 상단 메뉴 (⋮)
    ↓
[메뉴] "대화 내보내기" 선택
    ↓
[팝업] 형식 선택 (PDF/텍스트/JSON)
    ↓
[시스템] 파일 생성
    ↓
[시스템] 다운로드 제공
```

---

### 2.4 첨부파일 업로드

#### 2.4.1 지원 파일 형식

**문서 파일**
- HWP (한글 2014 이상)
- PDF
- DOCX, DOC
- XLSX, XLS
- PPTX, PPT
- TXT

**이미지 파일**
- JPG, JPEG
- PNG
- GIF (정적)
- WEBP

**압축 파일**
- ZIP
- RAR (향후 지원)

**파일 제한**
- 개별 파일 최대 크기: 50MB
- 한 번에 최대 첨부: 5개
- 총 용량 제한: 100MB

#### 2.4.2 업로드 방법

**방법 1: 드래그 앤 드롭**
```
[사용자] 파일을 대화창으로 드래그
    ↓
[시스템] 드롭 영역 하이라이트 표시
    ↓
[사용자] 파일 드롭
    ↓
[시스템] 파일 검증 (형식, 크기)
    ↓
[시스템] 업로드 진행 (프로그레스 바)
    ↓
[시스템] 업로드 완료 및 미리보기 표시
```

**방법 2: 파일 선택**
```
[사용자] 📎 첨부 버튼 클릭
    ↓
[시스템] 파일 선택 다이얼로그 표시
    ↓
[사용자] 파일 선택 및 열기
    ↓
[시스템] 업로드 처리
```

**방법 3: 클립보드 붙여넣기**
```
[사용자] 파일 또는 이미지 복사
    ↓
[사용자] 대화 입력창에 Ctrl+V (Cmd+V)
    ↓
[시스템] 클립보드 내용 확인
    ↓
[시스템] 이미지/파일 업로드 처리
```

#### 2.4.3 업로드 진행 표시

**업로드 중**
```
┌─────────────────────────────────────┐
│ 📎 방과후학교_계획서.hwp             │
│ ▓▓▓▓▓▓▓▓▓▓░░░░░ 65%  (2.3 MB / 3.5 MB)│
│ [업로드 취소]                        │
└─────────────────────────────────────┘
```

**업로드 완료**
```
┌─────────────────────────────────────┐
│ 📎 방과후학교_계획서.hwp             │
│ ✅ 3.5 MB • HWP 문서                 │
│ [보기] [삭제]                        │
└─────────────────────────────────────┘
```

**업로드 실패**
```
┌─────────────────────────────────────┐
│ 📎 방과후학교_계획서.hwp             │
│ ❌ 업로드 실패: 파일 크기 초과       │
│    최대 50MB까지 업로드 가능합니다   │
│ [다시 시도] [닫기]                   │
└─────────────────────────────────────┘
```

#### 2.4.4 파일 처리 및 분석

**텍스트 추출**
```
[파일 업로드 완료]
    ↓
[시스템] 파일 형식 확인
    ↓
─────── 텍스트 추출 가능 ───────
[시스템] OCR 또는 문서 파싱 실행
    ↓
[시스템] 텍스트 추출
    ↓
[시스템] RAG 시스템에 임시 저장
    ↓
[AI] 파일 내용을 컨텍스트로 활용
    
─────── 이미지 파일 ───────
[시스템] 이미지 분석 (OCR)
    ↓
[AI] 이미지 내용 이해 및 답변

─────── 기타 파일 ───────
[시스템] 메타데이터만 저장
    ↓
[AI] 파일명 및 형식 정보만 활용
```

**처리 예시**

**시나리오 1: HWP 파일 분석**
```
[사용자] "이 문서를 검토해주세요" + 기안문.hwp 업로드

[AI 응답]
파일을 확인했습니다.

📄 기안문.hwp 분석 결과:

제목: 2025학년도 방과후학교 강사 채용 기안
담당: 방과후부
내용: 방과후학교 강사 4명 채용 관련 기안

검토 의견:
1. ✅ 필수 항목 모두 포함
2. ⚠️  예산 항목에 세부 내역 추가 필요
3. ⚠️  첨부서류 목록 누락

수정이 필요한 부분을 고쳐드릴까요?
```

**시나리오 2: 이미지 OCR**
```
[사용자] "이 사진의 내용을 정리해주세요" + 손글씨_메모.jpg

[AI 응답]
사진의 손글씨 내용을 인식했습니다.

📝 인식된 내용:
• 학부모 상담 일정: 2월 5일 오후 2시
• 상담 학생: 김○○ (3학년 2반)
• 상담 주제: 학습 태도 및 교우 관계
• 준비 사항: 학생 생활기록 자료

이 내용으로 상담 기록지를 작성해드릴까요?
```

**시나리오 3: 여러 파일 비교**
```
[사용자] "이 두 문서의 차이점을 알려주세요" 
         + 2024_계획서.hwp
         + 2025_계획서.hwp

[AI 응답]
두 문서를 비교했습니다.

📊 주요 변경사항:

1. 운영 기간
   2024: 3월~12월 (10개월)
   2025: 3월~익년 2월 (12개월) ✨

2. 프로그램 수
   2024: 15개
   2025: 20개 (+5개 증가) ✨

3. 예산
   2024: 15,000천원
   2025: 20,000천원 (+33% 증가)

4. 신설 프로그램
   • 코딩 교실
   • 로봇 과학
   • 드론 체험
   • 영어 회화
   • AI 활용

더 자세한 비교가 필요하신가요?
```

#### 2.4.5 첨부파일 관리

**메시지 내 표시**
```
[사용자 메시지]
┌────────────────────────────────────┐
│ 이 문서 검토 부탁드립니다           │
│                                     │
│ 📎 방과후학교_운영계획서.hwp        │
│    3.5 MB • 2025-01-18 업로드       │
│    [다운로드]                       │
│                              09:15  │
└────────────────────────────────────┘
```

**다운로드**
```
[사용자] 첨부파일 클릭 또는 [다운로드] 버튼
    ↓
[시스템] 원본 파일명으로 다운로드
    ↓
[브라우저] 다운로드 폴더에 저장
```

**보기 (미리보기)**
```
[사용자] [보기] 버튼 클릭
    ↓
[시스템] 파일 형식 확인
    ↓
─────── PDF/이미지 ───────
[시스템] 모달 창에서 미리보기 표시

─────── 문서 파일 ───────
[시스템] 텍스트 추출 결과 표시

─────── 기타 ───────
[시스템] 다운로드 안내
```

#### 2.4.6 보안 및 제한

**바이러스 검사**
```
[파일 업로드 시작]
    ↓
[시스템] 실시간 바이러스 스캔
    ↓
─────── 안전 ───────
[시스템] 업로드 진행

─────── 위험 감지 ───────
[시스템] 업로드 차단
    ↓
[경고 표시]
⚠️  보안 위험이 감지되었습니다.
이 파일은 업로드할 수 없습니다.
```

**개인정보 보호**
- 업로드된 파일은 암호화 저장
- 대화 삭제 시 첨부파일도 함께 삭제
- 파일 접근 권한은 파일 업로드한 사용자만 가능
- 관리자도 별도 권한 없이 접근 불가

**저장 기간**
- 대화 활성 상태: 무제한 보관
- 대화 삭제 후: 즉시 파일 삭제
- 계정 탈퇴 시: 모든 파일 완전 삭제

---

## 3. 화면 정의서

### 3.1 메인 대화 화면

#### 3.1.1 전체 레이아웃

```
┌─────────────────────────────────────────────────────────────────┐
│ ☰  YouthSchool                    [🔔] [⚙️] [👤 김대리]        │
├──────────┬──────────────────────────────────────────────────────┤
│          │  Claude (MCP) ▼                          [무료 플랜]  │
│ [+ 새대화] │                                         [고객센터]  │
│          │                                                       │
│ 🔍 검색   │                                                       │
│          │              김○○ 선생님,                              │
│━ 오늘 ━━│                                                       │
│          │     접속시간이 가까워지고 있습니다 👋                  │
│ 📄 방과후 │     학생들과 함께하는 멋있는 시간이 되길 바랍니다!   │
│   가정통신문│                                                       │
│   09:30   │     무엇을 도와드릴까요?                               │
│          │                                                       │
│ 📊 학사일정│                                                       │
│   공지사항│     ┌──────────────────────────────────┐          │
│   08:45   │     │ 💡 빠른 시작                      │          │
│          │     ├──────────────────────────────────┤          │
│━ 어제 ━━│     │ • "방과후학교 가정통신문 작성"    │          │
│          │     │ • "학사일정 공지사항 만들기"      │          │
│ 📝 현장체험│     │ • "학부모 상담 기록 작성"         │          │
│   학습계획 │     │ • "현장체험학습 계획서 작성"      │          │
│   15:20   │     └──────────────────────────────────┘          │
│          │                                                       │
│ 🎓 학부모 │                                                       │
│   상담기록 │                                                       │
│   14:30   │                                                       │
│          │                                                       │
│━ 이번주━│                                                       │
│          │                                                       │
│ ...      │                                                       │
│          │                                                       │
│          │                                                       │
│          │                                                       │
│          ├───────────────────────────────────────────────────┤
│          │ 무엇을 도와드릴까요?                                   │
│          │                                                       │
│          │ [+] [📎] [🎤]                                [↑전송] │
└──────────┴──────────────────────────────────────────────────────┘

[좌측 사이드바: 260px]
[메인 대화 영역: 가변]
```

#### 3.1.2 상단 헤더

```
┌──────────────────────────────────────────────────────────┐
│ Claude (MCP) ▼              [무료 플랜] [고객센터]        │
└──────────────────────────────────────────────────────────┘
```

**구성 요소**
- **AI 모델 선택**: Claude (MCP) - 클릭하면 모델 변경 가능
- **플랜 표시**: 무료/유료 플랜 표시
- **고객센터**: 도움말 및 지원

#### 3.1.3 좌측 사이드바

**새 대화 버튼**
```
┌──────────────────────┐
│ [+ 새 대화]          │
└──────────────────────┘
```
- 위치: 최상단
- 크기: 전체 너비
- 색상: 강조색 (Primary)
- 동작: 클릭 시 새 대화 시작

**검색 영역**
```
┌──────────────────────┐
│ 🔍 [검색...]         │
└──────────────────────┘
```
- 실시간 검색
- 대화 제목 및 내용 검색

**대화 목록**
```
━━━━━ 오늘 ━━━━━

📄 방과후학교 가정통신문
   "방과후학교 가정통..."  09:30

📊 학사일정 공지사항  
   "1학기 학사일정..."    08:45
   
━━━━━ 어제 ━━━━━

📝 현장체험학습 계획서
   "현장체험학습 계획..." 15:20
   [📌]  ← 고정 표시
```

**각 대화 항목**
- 아이콘 (카테고리 자동 분류)
- 제목 (자동 생성, 수동 수정 가능)
- 미리보기 (첫 메시지 30자)
- 시간
- 고정 표시 (📌)

**우클릭 메뉴**
```
┌────────────────┐
│ 제목 변경      │
│ 상단 고정      │
│ 내보내기       │
│ ──────────     │
│ 삭제           │
└────────────────┘
```

#### 3.1.4 대화 입력 영역

```
┌─────────────────────────────────────────────────────────┐
│ 무엇을 도와드릴까요?                                     │
│                                                         │
│ [+] [📎] [🎤]                                    [↑전송]│
└─────────────────────────────────────────────────────────┘
```

**구성 요소**

1. **텍스트 입력창**
   - 플레이스홀더: "무엇을 도와드릴까요?"
   - 멀티라인 지원
   - 자동 높이 조절 (최대 5줄)
   - 글자 수 표시 (9,000자 이상 시)

2. **왼쪽 버튼들**
   - **[+]**: 추가 기능 메뉴
     - 빠른 명령어
     - 템플릿 불러오기
   - **[📎]**: 파일 첨부
   - **[🎤]**: 음성 입력 (향후 지원)

3. **전송 버튼 [↑]**
   - 메시지 입력 시 활성화 (강조색)
   - 비어있으면 비활성화 (회색)
   - 단축키: Enter (Shift+Enter는 줄바꿈)

**파일 첨부 시 미리보기**
```
┌─────────────────────────────────────────────────────────┐
│ 📎 방과후학교_계획서.hwp                                 │
│ 3.5 MB • HWP 문서                                  [❌] │
├─────────────────────────────────────────────────────────┤
│ 무엇을 도와드릴까요?                                     │
│                                                         │
│ [+] [📎] [🎤]                                    [↑전송]│
└─────────────────────────────────────────────────────────┘
```

### 3.2 대화 중 화면

#### 3.2.1 사용자 메시지

```
┌──────────────────────────────────────────────────────────┐
│                                                          │
│                                         [김○○ 선생님] 👤 │
│                        방과후학교 가정통신문 만들어주세요  │
│                                                          │
│                                                    09:15 │
└──────────────────────────────────────────────────────────┘
```

**스타일**
- 배경색: 하늘색 계열 (#E3F2FD)
- 텍스트 정렬: 우측
- 테두리 반경: 16px
- 패딩: 12px 16px
- 최대 너비: 70%
- 그림자: 미세한 그림자

**첨부파일이 있는 경우**
```
┌──────────────────────────────────────────────────────────┐
│                                         [김○○ 선생님] 👤 │
│                                     이 문서 검토해주세요   │
│                                                          │
│                        ┌──────────────────────────────┐ │
│                        │ 📎 방과후_계획서.hwp          │ │
│                        │ 3.5 MB                       │ │
│                        │ [다운로드]                   │ │
│                        └──────────────────────────────┘ │
│                                                    09:15 │
└──────────────────────────────────────────────────────────┘
```

#### 3.2.2 AI 응답 메시지

```
┌──────────────────────────────────────────────────────────┐
│ 🤖                                                       │
│ 안녕하세요! 방과후학교 가정통신문을 작성해드리겠습니다.   │
│                                                          │
│ 몇 가지 정보가 필요합니다:                                │
│ 1. 프로그램 운영 기간은 언제인가요?                       │
│ 2. 대상 학년을 알려주세요                                │
│ 3. 주요 프로그램 종류를 알려주세요                        │
│                                                          │
│ 위 정보를 알려주시면 적절한 가정통신문을 작성하겠습니다!   │
│                                                          │
│ ────────────────────────────────────────────────        │
│ 📚 참고 자료                                              │
│ • 교육부 "방과후학교 운영 가이드라인" (2024)             │
│ • 서울교육청 "가정통신문 작성 예시" (2024-12-15)         │
│                                                          │
│ 09:15                                                    │
│ [📋 복사] [🔄 재생성] [👍] [👎]                          │
└──────────────────────────────────────────────────────────┘
```

**스타일**
- 배경색: 흰색 (#FFFFFF)
- 테두리: 연한 회색 (1px)
- 텍스트 정렬: 좌측
- 테두리 반경: 16px
- 패딩: 16px 20px
- 최대 너비: 85%
- 그림자: 미세한 그림자

**AI 아이콘**
- 위치: 메시지 좌측 상단
- 크기: 32px × 32px
- 이미지: 로봇 또는 AI 아이콘

**액션 버튼**
```
[📋 복사]   : 메시지 내용 클립보드 복사
[🔄 재생성] : 같은 질문으로 재생성
[👍]        : 좋은 답변 피드백
[👎]        : 나쁜 답변 피드백
```

#### 3.2.3 로딩 상태

**답변 생성 중**
```
┌──────────────────────────────────────────────────────────┐
│ 🤖                                                       │
│ ⋯ 답변을 생성하고 있습니다...                             │
│                                                          │
│ [●●●○○○] 관련 자료 검색 중                              │
└──────────────────────────────────────────────────────────┘
```

**스트리밍 답변**
```
┌──────────────────────────────────────────────────────────┐
│ 🤖                                                       │
│ 방과후학교 가정통신문을 작성해드리겠습니다.               │
│                                                          │
│ 다음과 같이 구성하는 것을 추천드립니다:                   │
│ 1. 인사말                                                │
│ 2. 운영 개요█                                            │
│   (계속 입력 중...)                                      │
└──────────────────────────────────────────────────────────┘
```

#### 3.2.4 오류 상태

**일반 오류**
```
┌──────────────────────────────────────────────────────────┐
│ ⚠️                                                       │
│ 죄송합니다. 일시적인 오류가 발생했습니다.                 │
│                                                          │
│ 잠시 후 다시 시도해주세요.                                │
│                                                          │
│ [다시 시도]                                              │
└──────────────────────────────────────────────────────────┘
```

**네트워크 오류**
```
┌──────────────────────────────────────────────────────────┐
│ 🌐                                                       │
│ 네트워크 연결이 불안정합니다.                             │
│                                                          │
│ 인터넷 연결을 확인하고 다시 시도해주세요.                 │
│                                                          │
│ [다시 시도]                                              │
└──────────────────────────────────────────────────────────┘
```

### 3.3 파일 업로드 화면

#### 3.3.1 드래그 앤 드롭 오버레이

```
┌──────────────────────────────────────────────────────────┐
│                                                          │
│                     ┌─────────────────┐                  │
│                     │                 │                  │
│                     │   📁            │                  │
│                     │                 │                  │
│                     │   파일을        │                  │
│                     │   여기에        │                  │
│                     │   놓으세요      │                  │
│                     │                 │                  │
│                     └─────────────────┘                  │
│                                                          │
└──────────────────────────────────────────────────────────┘
```

**스타일**
- 반투명 오버레이 (rgba(0, 0, 0, 0.5))
- 점선 테두리 박스
- 애니메이션: 부드러운 페이드인

#### 3.3.2 업로드 진행

```
┌──────────────────────────────────────────────────────────┐
│ 파일 업로드 중                                      [❌] │
├──────────────────────────────────────────────────────────┤
│                                                          │
│ 📎 방과후학교_계획서.hwp                                  │
│ ▓▓▓▓▓▓▓▓▓▓░░░░░ 65%                                    │
│ 2.3 MB / 3.5 MB                                          │
│                                                          │
│ 📎 학사일정_안내.pdf                                     │
│ ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓ 100%                                   │
│ ✅ 1.2 MB                                                │
│                                                          │
└──────────────────────────────────────────────────────────┘
```

**진행 표시**
- 개별 파일별 프로그레스 바
- 업로드 속도 및 남은 시간 (선택)
- 완료된 파일 체크마크
- 전체 취소 버튼

#### 3.3.3 업로드 완료

```
┌──────────────────────────────────────────────────────────┐
│ 📎 첨부된 파일 (2)                                        │
├──────────────────────────────────────────────────────────┤
│                                                          │
│ 📄 방과후학교_계획서.hwp                            [❌] │
│ 3.5 MB • 방금 전                                         │
│ [보기] [다운로드]                                        │
│                                                          │
│ 📑 학사일정_안내.pdf                                [❌] │
│ 1.2 MB • 방금 전                                         │
│ [보기] [다운로드]                                        │
│                                                          │
└──────────────────────────────────────────────────────────┘
```

### 3.4 반응형 디자인

#### 3.4.1 데스크톱 (1200px 이상)

```
[사이드바: 260px] [메인 영역: 가변]
```

- 좌측 사이드바 고정
- 대화 영역 중앙 정렬
- 최대 너비: 1200px

#### 3.4.2 태블릿 (768px ~ 1199px)

```
[사이드바: 접음/펼침] [메인 영역: 전체]
```

- 사이드바 접기/펼치기 토글
- 햄버거 메뉴 (☰)
- 대화 영역 전체 너비 활용

#### 3.4.3 모바일 (768px 미만)

```
[메인 영역만 표시]
[하단 탭바]
```

- 사이드바는 슬라이드 메뉴로 전환
- 대화 목록은 별도 화면
- 하단 탭: [대화] [목록] [설정]

---

## 4. 데이터베이스 스키마

### 4.1 대화 테이블 (chats)

```sql
CREATE TABLE chats (
    chat_id VARCHAR(50) PRIMARY KEY,
    user_id BIGINT NOT NULL,
    title VARCHAR(200) NOT NULL,
    category VARCHAR(50),
    is_pinned BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP NULL,
    
    INDEX idx_user_id (user_id),
    INDEX idx_updated_at (updated_at),
    INDEX idx_category (category),
    FOREIGN KEY (user_id) REFERENCES users(user_id)
);
```

### 4.2 메시지 테이블 (messages)

```sql
CREATE TABLE messages (
    message_id VARCHAR(50) PRIMARY KEY,
    chat_id VARCHAR(50) NOT NULL,
    role ENUM('user', 'assistant', 'system') NOT NULL,
    content TEXT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    INDEX idx_chat_id (chat_id),
    INDEX idx_created_at (created_at),
    FOREIGN KEY (chat_id) REFERENCES chats(chat_id) ON DELETE CASCADE
);
```

### 4.3 첨부파일 테이블 (attachments)

```sql
CREATE TABLE attachments (
    attachment_id BIGINT PRIMARY KEY AUTO_INCREMENT,
    message_id VARCHAR(50) NOT NULL,
    file_name VARCHAR(255) NOT NULL,
    file_path VARCHAR(500) NOT NULL,
    file_size BIGINT NOT NULL,
    file_type VARCHAR(50) NOT NULL,
    mime_type VARCHAR(100) NOT NULL,
    uploaded_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    INDEX idx_message_id (message_id),
    FOREIGN KEY (message_id) REFERENCES messages(message_id) ON DELETE CASCADE
);
```

### 4.4 RAG 소스 테이블 (rag_sources)

```sql
CREATE TABLE rag_sources (
    source_id BIGINT PRIMARY KEY AUTO_INCREMENT,
    message_id VARCHAR(50) NOT NULL,
    source_title VARCHAR(255) NOT NULL,
    source_url VARCHAR(500),
    source_date DATE,
    relevance_score FLOAT,
    
    INDEX idx_message_id (message_id),
    FOREIGN KEY (message_id) REFERENCES messages(message_id) ON DELETE CASCADE
);
```

### 4.5 피드백 테이블 (message_feedback)

```sql
CREATE TABLE message_feedback (
    feedback_id BIGINT PRIMARY KEY AUTO_INCREMENT,
    message_id VARCHAR(50) NOT NULL,
    user_id BIGINT NOT NULL,
    feedback_type ENUM('like', 'dislike') NOT NULL,
    feedback_comment TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    INDEX idx_message_id (message_id),
    INDEX idx_user_id (user_id),
    UNIQUE KEY unique_feedback (message_id, user_id),
    FOREIGN KEY (message_id) REFERENCES messages(message_id) ON DELETE CASCADE,
    FOREIGN KEY (user_id) REFERENCES users(user_id)
);
```

---

## 5. API 명세

### 5.1 대화 생성 API

**Endpoint**: `POST /api/v1/chats`

**Headers**:
```
Authorization: Bearer {token}
Content-Type: application/json
```

**Request Body**:
```json
{
  "title": "새 대화" // 선택사항, 미제공 시 자동 생성
}
```

**Response (Success - 201)**:
```json
{
  "success": true,
  "data": {
    "chat_id": "chat_20250118_001234",
    "user_id": 1234,
    "title": "새 대화",
    "created_at": "2025-01-18T09:15:00Z",
    "updated_at": "2025-01-18T09:15:00Z"
  }
}
```

---

### 5.2 메시지 전송 API

**Endpoint**: `POST /api/v1/chats/{chat_id}/messages`

**Headers**:
```
Authorization: Bearer {token}
Content-Type: multipart/form-data
```

**Request Body** (FormData):
```
message: "방과후학교 가정통신문 만들어주세요"
attachments[]: [File1, File2] // 선택사항
```

**Response (Success - 200)** (Server-Sent Events):
```
event: message_start
data: {"message_id": "msg_001"}

event: content_delta
data: {"delta": "방과후학교"}

event: content_delta
data: {"delta": " 가정통신문을"}

...

event: message_end
data: {"message_id": "msg_001", "sources": [...]}
```

---

### 5.3 대화 목록 조회 API

**Endpoint**: `GET /api/v1/chats`

**Headers**:
```
Authorization: Bearer {token}
```

**Query Parameters**:
```
?page=1&limit=20&sort=updated_at&order=desc&category=방과후학교
```

**Response (Success - 200)**:
```json
{
  "success": true,
  "data": {
    "chats": [
      {
        "chat_id": "chat_20250118_001234",
        "title": "방과후학교 가정통신문",
        "category": "방과후학교",
        "preview": "방과후학교 가정통신문 만들어주세요",
        "is_pinned": false,
        "created_at": "2025-01-18T09:15:00Z",
        "updated_at": "2025-01-18T09:30:00Z",
        "message_count": 10
      }
    ],
    "pagination": {
      "current_page": 1,
      "total_pages": 5,
      "total_count": 95,
      "limit": 20
    }
  }
}
```

---

### 5.4 대화 상세 조회 API

**Endpoint**: `GET /api/v1/chats/{chat_id}`

**Headers**:
```
Authorization: Bearer {token}
```

**Response (Success - 200)**:
```json
{
  "success": true,
  "data": {
    "chat_id": "chat_20250118_001234",
    "user_id": 1234,
    "title": "방과후학교 가정통신문",
    "category": "방과후학교",
    "is_pinned": false,
    "created_at": "2025-01-18T09:15:00Z",
    "updated_at": "2025-01-18T09:30:00Z",
    "messages": [
      {
        "message_id": "msg_001",
        "role": "user",
        "content": "방과후학교 가정통신문 만들어주세요",
        "created_at": "2025-01-18T09:15:00Z",
        "attachments": []
      },
      {
        "message_id": "msg_002",
        "role": "assistant",
        "content": "가정통신문을 작성해드리겠습니다...",
        "created_at": "2025-01-18T09:15:05Z",
        "sources": [
          {
            "title": "방과후학교 운영 가이드",
            "url": "https://...",
            "date": "2024-12-15"
          }
        ]
      }
    ]
  }
}
```

---

### 5.5 파일 업로드 API

**Endpoint**: `POST /api/v1/uploads`

**Headers**:
```
Authorization: Bearer {token}
Content-Type: multipart/form-data
```

**Request Body** (FormData):
```
file: [File]
```

**Response (Success - 200)**:
```json
{
  "success": true,
  "data": {
    "file_id": "file_20250118_001",
    "file_name": "방과후학교_계획서.hwp",
    "file_size": 3670016,
    "file_type": "hwp",
    "mime_type": "application/x-hwp",
    "uploaded_at": "2025-01-18T09:20:00Z",
    "url": "https://storage.youthschool.com/uploads/..."
  }
}
```

---

### 5.6 대화 삭제 API

**Endpoint**: `DELETE /api/v1/chats/{chat_id}`

**Headers**:
```
Authorization: Bearer {token}
```

**Response (Success - 200)**:
```json
{
  "success": true,
  "message": "대화가 삭제되었습니다."
}
```

---

## 6. 기술 스택

### 6.1 프론트엔드

**프레임워크**
- React 18+ 또는 Next.js 14+
- TypeScript

**상태 관리**
- Redux Toolkit 또는 Zustand
- React Query (서버 상태)

**UI 라이브러리**
- Tailwind CSS
- shadcn/ui 또는 MUI
- Framer Motion (애니메이션)

**실시간 통신**
- Server-Sent Events (SSE) for streaming
- WebSocket (향후 확장)

### 6.2 백엔드

**프레임워크**
- FastAPI (Python) 또는 Express (Node.js)

**AI/ML**
- Claude API (Anthropic)
- LangChain
- Vector DB: Pinecone 또는 Weaviate

**파일 처리**
- python-docx (DOCX)
- PyPDF2 (PDF)
- olefile (HWP)
- Pillow (이미지)

**스토리지**
- AWS S3 또는 Google Cloud Storage

### 6.3 데이터베이스

**주 데이터베이스**
- PostgreSQL 또는 MySQL

**벡터 데이터베이스**
- Pinecone
- Weaviate
- 또는 pgvector (PostgreSQL 확장)

**캐시**
- Redis

---

## 7. 보안 및 개인정보

### 7.1 데이터 암호화

**전송 중**
- HTTPS/TLS 1.3
- WebSocket Secure (WSS)

**저장 시**
- 데이터베이스 암호화 (AES-256)
- 파일 스토리지 암호화
- 메시지 내용 암호화

### 7.2 접근 제어

**인증**
- JWT 기반 인증
- 토큰 만료: 1시간 (Refresh: 7일)

**권한**
- 사용자는 본인의 대화만 접근 가능
- 첨부파일 다운로드는 업로더만 가능

### 7.3 데이터 보존

**활성 대화**
- 무제한 보관

**삭제된 대화**
- 즉시 삭제 (복구 불가)
- 첨부파일도 함께 삭제

**백업**
- 일일 자동 백업
- 30일 보관

---

## 8. 성능 요구사항

### 8.1 응답 시간

- 대화 목록 로딩: < 500ms
- 메시지 전송: < 100ms (전송 완료)
- AI 응답 시작: < 2초
- 파일 업로드: < 5초 (10MB 기준)

### 8.2 동시 사용자

- 최대 동시 사용자: 10,000명
- 대화 스트리밍: 1,000 concurrent

### 8.3 확장성

- 수평 확장 가능한 아키텍처
- 로드 밸런서
- CDN (정적 리소스)

---

## 9. 테스트 시나리오

### 9.1 기본 대화 테스트

**TC-001: 새 대화 시작**
```
1. 사용자 로그인
2. '새 대화' 버튼 클릭
3. 빈 대화 화면 표시 확인
4. 환영 메시지 확인
```

**TC-002: 메시지 전송**
```
1. 메시지 입력: "안녕하세요"
2. 전송 버튼 클릭
3. 사용자 메시지 화면에 표시 확인
4. AI 응답 수신 확인
5. 응답 시간 2초 이내 확인
```

### 9.2 RAG 답변 테스트

**TC-003: 전문 질문 답변**
```
입력: "방과후학교 운영 기준이 뭐야?"

기대 결과:
- RAG 데이터 기반 답변
- 출처 정보 포함
- 3초 이내 응답 시작
```

**TC-004: 범위 외 질문**
```
입력: "오늘 날씨 어때?"

기대 결과:
- 정중한 거절 메시지
- 가능한 질문 예시 제공
```

### 9.3 파일 업로드 테스트

**TC-005: 단일 파일 업로드**
```
1. HWP 파일 (3MB) 업로드
2. 진행 상태 표시 확인
3. 업로드 완료 확인
4. 미리보기 표시 확인
```

**TC-006: 파일 크기 초과**
```
1. 100MB 파일 업로드 시도
2. 오류 메시지 표시 확인
3. 업로드 차단 확인
```

---

## 10. 향후 확장 계획

### Phase 2 (2025 Q2)

- **음성 입력**: STT 기능
- **퀵 버튼**: 자주 쓰는 명령어
- **템플릿 라이브러리**: 문서 템플릿

### Phase 3 (2025 Q3)

- **대화 공유**: 다른 교사와 공유
- **협업 기능**: 여러 명이 함께 문서 작성
- **모바일 앱**: iOS/Android

### Phase 4 (2025 Q4)

- **AI 음성 출력**: TTS 기능
- **실시간 협업**: 동시 편집
- **고급 분석**: 사용 패턴 분석

---

## 부록

### A. 용어 정의

- **RAG**: Retrieval-Augmented Generation
- **SSE**: Server-Sent Events
- **JWT**: JSON Web Token
- **TTS**: Text-to-Speech
- **STT**: Speech-to-Text

### B. 참고 자료

- Claude API 문서: https://docs.anthropic.com
- LangChain 문서: https://python.langchain.com
- React 공식 문서: https://react.dev

---

**문서 끝**

**작성**: YouthSchool Team  
**검토**: 김대리  
**승인**: -  
**버전 히스토리**:
- v1.0 (2025-01-18): 초안 작성
